{"ast":null,"code":"var _jsxFileName = \"/home/ondaniel/santiago/sisgie-frontend/src/pages/Profiles/index.tsx\";\nimport React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { Form } from '@unform/web';\nimport { FiBriefcase, FiEdit2 } from 'react-icons/fi';\nimport { ValidationError as YupValidationError } from 'yup';\nimport { toast } from 'react-toastify';\nimport { Container, Main, ButtonGroup, DoubleColumn } from './styles';\nimport Loading from '../../components/Loading';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Title from '../../components/Title';\nimport Input from '../../components/Input';\nimport Checkbox from '../../components/Checkbox';\nimport Button from '../../components/Button';\nimport ProfilesList from '../../components/List';\nimport api from '../../services/api';\nimport profileSchema from '../../schemas/profileSchema';\nimport getValidationErrors from '../../utils/getValidationErrors';\n\nconst Profiles = () => {\n  const formRef = useRef(null);\n  const [profiles, setProfiles] = useState([]);\n  const [profileId, setProfileId] = useState('');\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n  useEffect(() => {\n    setLoadingPage(true);\n    api.get('/profiles').then(response => setProfiles(response.data)).catch(() => {\n      toast.error('Erro ao carregar perfis! Por favor, tente novamente mais tarde.');\n    }).finally(() => {\n      setLoadingPage(false);\n    });\n  }, []);\n  const handleGetProfile = useCallback(data => {\n    var _formRef$current, _formRef$current2;\n\n    setProfileId(data.id);\n    (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n    (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setData(data);\n  }, []);\n  const handleUngetProfile = useCallback(() => {\n    var _formRef$current3, _formRef$current4;\n\n    setProfileId('');\n    (_formRef$current3 = formRef.current) === null || _formRef$current3 === void 0 ? void 0 : _formRef$current3.setErrors({});\n    (_formRef$current4 = formRef.current) === null || _formRef$current4 === void 0 ? void 0 : _formRef$current4.reset();\n  }, []);\n  const handleAddProfile = useCallback(async (data, {\n    reset\n  }) => {\n    if (loadingSubmit) {\n      return;\n    }\n\n    setLoadingSubmit(true);\n\n    try {\n      var _formRef$current5;\n\n      (_formRef$current5 = formRef.current) === null || _formRef$current5 === void 0 ? void 0 : _formRef$current5.setErrors({});\n      await profileSchema.validate(data, {\n        abortEarly: false\n      });\n      const response = await api.post('/profiles', data);\n      setProfiles([...profiles, response.data]);\n      reset();\n      toast.success('Perfil criado com sucesso!');\n    } catch (err) {\n      if (err instanceof YupValidationError) {\n        var _formRef$current6;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current6 = formRef.current) === null || _formRef$current6 === void 0 ? void 0 : _formRef$current6.setErrors(errors);\n        return;\n      }\n\n      if (err.response) {\n        toast.error(`Erro ao criar perfil: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');\n      }\n    } finally {\n      setLoadingSubmit(false);\n    }\n  }, [profiles, loadingSubmit]);\n  const handleUpdateProfile = useCallback(async (data, {\n    reset\n  }) => {\n    if (loadingSubmit) {\n      return;\n    }\n\n    setLoadingSubmit(true);\n\n    try {\n      var _formRef$current7;\n\n      (_formRef$current7 = formRef.current) === null || _formRef$current7 === void 0 ? void 0 : _formRef$current7.setErrors({});\n      await profileSchema.validate(data, {\n        abortEarly: false\n      });\n      const response = await api.put(`/profiles/${profileId}`, data);\n      const profilesWithoutEdited = profiles.filter(profile => profile.id !== profileId);\n      setProfiles([...profilesWithoutEdited, response.data]);\n      setProfileId('');\n      reset();\n      toast.success('Perfil atualizado com sucesso!');\n    } catch (err) {\n      if (err instanceof YupValidationError) {\n        var _formRef$current8;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current8 = formRef.current) === null || _formRef$current8 === void 0 ? void 0 : _formRef$current8.setErrors(errors);\n        return;\n      }\n\n      if (err.response) {\n        toast.error(`Erro ao atualizar perfil: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor tente novamente mais tarde.');\n      }\n    } finally {\n      setLoadingSubmit(false);\n    }\n  }, [profiles, profileId, loadingSubmit]);\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Loading, {\n    show: loadingPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Aside, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Main, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Title, {\n    title: \"Gerenciar perfis e permiss\\xF5es\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(DoubleColumn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    ref: formRef,\n    onSubmit: !profileId ? handleAddProfile : handleUpdateProfile,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Nome\",\n    name: \"name\",\n    icon: FiBriefcase,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"create_new_enrollments_permiss\",\n    label: \"Criar nova matr\\xEDcula\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"validate_enrollments_permiss\",\n    label: \"Aprovar e desaprovar matr\\xEDculas\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"create_extra_debits_permiss\",\n    label: \"Criar d\\xE9bitos extras\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"pay_debits_permiss\",\n    label: \"Pagar d\\xE9bitos\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"discharge_payments_permiss\",\n    label: \"Receber pagamentos\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"crud_profiles_permiss\",\n    label: \"Gerenciar perfis\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"crud_users_permiss\",\n    label: \"Gerenciar usu\\xE1rios\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"crud_grades_permiss\",\n    label: \"Gerenciar turmas\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"crud_extra_debits_permiss\",\n    label: \"Gerenciar d\\xE9bitos extras\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 13\n    }\n  }, !profileId ? /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    loading: loadingSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 17\n    }\n  }, \"Adicionar\") : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    loading: loadingSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 19\n    }\n  }, \"Atualizar\"), /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    backgroundColor: \"#f44336\",\n    onClick: handleUngetProfile,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 19\n    }\n  }, \"Cancelar\")))), profiles.length > 0 && /*#__PURE__*/React.createElement(ProfilesList, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 13\n    }\n  }, profiles.map(profile => /*#__PURE__*/React.createElement(\"li\", {\n    key: profile.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FiEdit2, {\n    size: 20,\n    onClick: () => handleGetProfile(profile),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 19\n    }\n  }, profile.name)))))));\n};\n\nexport default Profiles;","map":{"version":3,"sources":["/home/ondaniel/santiago/sisgie-frontend/src/pages/Profiles/index.tsx"],"names":["React","useState","useCallback","useEffect","useRef","Form","FiBriefcase","FiEdit2","ValidationError","YupValidationError","toast","Container","Main","ButtonGroup","DoubleColumn","Loading","Header","Aside","Title","Input","Checkbox","Button","ProfilesList","api","profileSchema","getValidationErrors","Profiles","formRef","profiles","setProfiles","profileId","setProfileId","loadingPage","setLoadingPage","loadingSubmit","setLoadingSubmit","get","then","response","data","catch","error","finally","handleGetProfile","id","current","setErrors","setData","handleUngetProfile","reset","handleAddProfile","validate","abortEarly","post","success","err","errors","message","handleUpdateProfile","put","profilesWithoutEdited","filter","profile","length","map","name"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { FormHandles } from '@unform/core';\nimport { Form } from '@unform/web';\nimport { FiBriefcase, FiEdit2 } from 'react-icons/fi';\nimport { ValidationError as YupValidationError } from 'yup';\nimport { toast } from 'react-toastify';\n\nimport { Container, Main, ButtonGroup, DoubleColumn } from './styles';\nimport Loading from '../../components/Loading';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Title from '../../components/Title';\nimport Input from '../../components/Input';\nimport Checkbox from '../../components/Checkbox';\nimport Button from '../../components/Button';\nimport ProfilesList from '../../components/List';\nimport IProfile from '../../entities/IProfile';\nimport api from '../../services/api';\nimport profileSchema from '../../schemas/profileSchema';\nimport getValidationErrors from '../../utils/getValidationErrors';\n\nconst Profiles: React.FC = () => {\n  const formRef = useRef<FormHandles>(null);\n\n  const [profiles, setProfiles] = useState([] as IProfile[]);\n  const [profileId, setProfileId] = useState('');\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n\n  useEffect(() => {\n    setLoadingPage(true);\n    api\n      .get('/profiles')\n      .then(response => setProfiles(response.data))\n      .catch(() => {\n        toast.error(\n          'Erro ao carregar perfis! Por favor, tente novamente mais tarde.',\n        );\n      })\n      .finally(() => {\n        setLoadingPage(false);\n      });\n  }, []);\n\n  const handleGetProfile = useCallback((data: IProfile) => {\n    setProfileId(data.id);\n\n    formRef.current?.setErrors({});\n\n    formRef.current?.setData(data);\n  }, []);\n\n  const handleUngetProfile = useCallback(() => {\n    setProfileId('');\n\n    formRef.current?.setErrors({});\n\n    formRef.current?.reset();\n  }, []);\n\n  const handleAddProfile = useCallback(\n    async (data: Omit<IProfile, 'id'>, { reset }) => {\n      if (loadingSubmit) {\n        return;\n      }\n\n      setLoadingSubmit(true);\n\n      try {\n        formRef.current?.setErrors({});\n\n        await profileSchema.validate(data, {\n          abortEarly: false,\n        });\n\n        const response = await api.post('/profiles', data);\n\n        setProfiles([...profiles, response.data]);\n\n        reset();\n\n        toast.success('Perfil criado com sucesso!');\n      } catch (err) {\n        if (err instanceof YupValidationError) {\n          const errors = getValidationErrors(err);\n          formRef.current?.setErrors(errors);\n          return;\n        }\n\n        if (err.response) {\n          toast.error(`Erro ao criar perfil: ${err.response.data.message}`);\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n          );\n        }\n      } finally {\n        setLoadingSubmit(false);\n      }\n    },\n    [profiles, loadingSubmit],\n  );\n\n  const handleUpdateProfile = useCallback(\n    async (data: Omit<IProfile, 'id'>, { reset }) => {\n      if (loadingSubmit) {\n        return;\n      }\n\n      setLoadingSubmit(true);\n\n      try {\n        formRef.current?.setErrors({});\n\n        await profileSchema.validate(data, {\n          abortEarly: false,\n        });\n\n        const response = await api.put(`/profiles/${profileId}`, data);\n\n        const profilesWithoutEdited = profiles.filter(\n          profile => profile.id !== profileId,\n        );\n\n        setProfiles([...profilesWithoutEdited, response.data]);\n\n        setProfileId('');\n\n        reset();\n\n        toast.success('Perfil atualizado com sucesso!');\n      } catch (err) {\n        if (err instanceof YupValidationError) {\n          const errors = getValidationErrors(err);\n          formRef.current?.setErrors(errors);\n          return;\n        }\n\n        if (err.response) {\n          toast.error(`Erro ao atualizar perfil: ${err.response.data.message}`);\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor tente novamente mais tarde.',\n          );\n        }\n      } finally {\n        setLoadingSubmit(false);\n      }\n    },\n    [profiles, profileId, loadingSubmit],\n  );\n\n  return (\n    <Container>\n      <Loading show={loadingPage} />\n\n      <Header />\n\n      <Aside />\n\n      <Main>\n        <Title title=\"Gerenciar perfis e permissões\" />\n\n        <DoubleColumn>\n          <Form\n            ref={formRef}\n            onSubmit={!profileId ? handleAddProfile : handleUpdateProfile}\n          >\n            <Input placeholder=\"Nome\" name=\"name\" icon={FiBriefcase} />\n\n            <Checkbox\n              name=\"create_new_enrollments_permiss\"\n              label=\"Criar nova matrícula\"\n            />\n\n            <Checkbox\n              name=\"validate_enrollments_permiss\"\n              label=\"Aprovar e desaprovar matrículas\"\n            />\n\n            <Checkbox\n              name=\"create_extra_debits_permiss\"\n              label=\"Criar débitos extras\"\n            />\n\n            <Checkbox name=\"pay_debits_permiss\" label=\"Pagar débitos\" />\n\n            <Checkbox\n              name=\"discharge_payments_permiss\"\n              label=\"Receber pagamentos\"\n            />\n\n            <Checkbox name=\"crud_profiles_permiss\" label=\"Gerenciar perfis\" />\n\n            <Checkbox name=\"crud_users_permiss\" label=\"Gerenciar usuários\" />\n\n            <Checkbox name=\"crud_grades_permiss\" label=\"Gerenciar turmas\" />\n\n            <Checkbox\n              name=\"crud_extra_debits_permiss\"\n              label=\"Gerenciar débitos extras\"\n            />\n\n            <ButtonGroup>\n              {!profileId ? (\n                <Button type=\"submit\" loading={loadingSubmit}>\n                  Adicionar\n                </Button>\n              ) : (\n                <>\n                  <Button type=\"submit\" loading={loadingSubmit}>\n                    Atualizar\n                  </Button>\n\n                  <Button\n                    type=\"submit\"\n                    backgroundColor=\"#f44336\"\n                    onClick={handleUngetProfile}\n                  >\n                    Cancelar\n                  </Button>\n                </>\n              )}\n            </ButtonGroup>\n          </Form>\n\n          {profiles.length > 0 && (\n            <ProfilesList>\n              {profiles.map(profile => (\n                <li key={profile.id}>\n                  <FiEdit2\n                    size={20}\n                    onClick={() => handleGetProfile(profile)}\n                  />\n                  {/* <FiTrash\n                    size={20}\n                    onClick={() => handleRemoveProfile(profile.id)}\n                  /> */}\n                  <span>{profile.name}</span>\n                </li>\n              ))}\n            </ProfilesList>\n          )}\n        </DoubleColumn>\n      </Main>\n    </Container>\n  );\n};\n\nexport default Profiles;\n"]},"metadata":{},"sourceType":"module"}