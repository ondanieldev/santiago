{"ast":null,"code":"var _jsxFileName = \"/home/ondaniel/santiago/main/new_frontend/src/pages/ExtraDebitsByContract/index.tsx\";\nimport React, { useEffect, useState, useCallback, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Form } from '@unform/web';\nimport { FiCalendar, FiDollarSign, FiFileText, FiPercent } from 'react-icons/fi';\nimport { toast } from 'react-toastify';\nimport { isPast, differenceInCalendarMonths, parseISO } from 'date-fns';\nimport { Container, Main, InputGroup, Debit, FormGroup, ButtonGroup } from './styles';\nimport Loading from '../../components/Loading';\nimport Title from '../../components/Title';\nimport Table from '../../components/Table';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Input from '../../components/Input';\nimport Button from '../../components/Button';\nimport api from '../../services/api';\nimport getValidationErrors from '../../utils/getValidationErrors';\nimport { prettyDate, formatCoin } from '../../utils/formatFunctions';\n\nconst ExtraDebitsByContract = () => {\n  const formRef = useRef(null);\n  const {\n    contract_id\n  } = useParams();\n  const [debits, setDebits] = useState([]);\n  const [selectedDebit, setSelectedDebit] = useState({});\n  const [payment, setPayment] = useState({});\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n  const handleEditExtraDebit = useCallback(async ({\n    contracts_ids,\n    description,\n    discount,\n    payment_limit_date,\n    value\n  }) => {\n    try {\n      var _formRef$current;\n\n      setLoadingSubmit(true);\n      (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n      const validateFormData = Yup.object().shape({\n        description: Yup.string().required('Descrião obrigatória'),\n        discount: Yup.number().typeError(() => 'Desconto precisa ser numérico'),\n        payment_limit_date: Yup.date().typeError(() => 'Deata inválida').required(),\n        value: Yup.number().typeError(() => 'O valor precisa ser numérico').required()\n      });\n      await validateFormData.validate({\n        description,\n        discount,\n        payment_limit_date,\n        value\n      }, {\n        abortEarly: false\n      });\n      const selectedContracts = Object.entries(contracts_ids);\n      const promises = [];\n      selectedContracts.forEach(([contract_id, selected]) => {\n        if (selected) {\n          promises.push(api.post('/debits/extra', {\n            contract_id,\n            description,\n            discount,\n            payment_limit_date,\n            value\n          }));\n        }\n      });\n      await Promise.all(promises);\n      toast.success('Débitos criados com sucesso!');\n    } catch (err) {\n      if (err instanceof Yup.ValidationError) {\n        var _formRef$current2;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setErrors(errors);\n        toast.error('Oops... alguns dados não foram preenchidos corretamente!');\n        return;\n      }\n\n      if (err.response) {\n        toast.error(`Erro ao criar débito: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');\n      }\n    } finally {\n      setLoadingSubmit(false);\n    }\n  }, []);\n  useEffect(() => {\n    setLoadingPage(true);\n    api.get(`contracts/${contract_id}/debits/extra`).then(response => {\n      const debitsFromApi = response.data;\n      debitsFromApi.forEach(debit => {\n        const parsedDebitDate = parseISO(debit.payment_limit_date.toString());\n        let true_value = debit.value;\n\n        if (isPast(parsedDebitDate)) {\n          const months = differenceInCalendarMonths(new Date(), parsedDebitDate);\n          true_value = debit.value * 1.03 ** months;\n        } else {\n          true_value = debit.value - debit.value * debit.discount / 100;\n        }\n\n        Object.assign(debit, {\n          true_value\n        });\n      });\n      setDebits(response.data);\n    }).catch(() => {\n      toast.error('Erro ao carregar débitos! Por favor, tente novamente mais tarde.');\n    }).finally(() => {\n      setLoadingPage(false);\n    });\n  }, [contract_id]);\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Loading, {\n    show: loadingPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Aside, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Main, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Title, {\n    title: \"Gerenciar d\\xE9bitos adicionais\",\n    subtitle: `Contrato #${contract_id}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Form, {\n    ref: formRef,\n    onSubmit: handleEditExtraDebit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(FormGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    icon: FiFileText,\n    name: \"description\",\n    placeholder: \"Descri\\xE7\\xE3o\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    icon: FiDollarSign,\n    type: \"number\",\n    step: \"0.01\",\n    name: \"value\",\n    placeholder: \"Valor\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    icon: FiPercent,\n    type: \"number\",\n    step: \"0.01\",\n    name: \"discount\",\n    placeholder: \"Desconto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    icon: FiCalendar,\n    type: \"date\",\n    name: \"payment_limit_date\",\n    label: \"Data limite de pagamento\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 15\n    }\n  }, \"Editar\"), /*#__PURE__*/React.createElement(Button, {\n    type: \"button\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 15\n    }\n  }, \"Cancelar\")))), /*#__PURE__*/React.createElement(Table, {\n    isVoid: debits.length <= 0,\n    voidMessage: \"N\\xE3o h\\xE1 d\\xE9bitos para serem pagos!\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"thead\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 15\n    }\n  }, \"Descri\\xE7\\xE3o\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 15\n    }\n  }, \"Valor\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 15\n    }\n  }, \"Valor com varia\\xE7\\xE3o\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 15\n    }\n  }, \"Data limite do pagamento\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 15\n    }\n  }, \"Data de pagamento\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 15\n    }\n  }, \"A\\xE7\\xF5es\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 11\n    }\n  }, debits.map(debit => /*#__PURE__*/React.createElement(Debit, {\n    paid: debit.paid,\n    key: debit.id,\n    onClick: () => setSelectedDebit(debit),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 17\n    }\n  }, debit.description), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 17\n    }\n  }, formatCoin(debit.value)), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 17\n    }\n  }, debit.true_value ? formatCoin(debit.true_value) : debit.value), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 17\n    }\n  }, prettyDate(debit.payment_limit_date)), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 17\n    }\n  }, debit.payday ? prettyDate(debit.payday) : '-'), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 17\n    }\n  }, \"Bot\\xF5es\")))))));\n};\n\nexport default ExtraDebitsByContract;","map":{"version":3,"sources":["/home/ondaniel/santiago/main/new_frontend/src/pages/ExtraDebitsByContract/index.tsx"],"names":["React","useEffect","useState","useCallback","useRef","useParams","Form","FiCalendar","FiDollarSign","FiFileText","FiPercent","toast","isPast","differenceInCalendarMonths","parseISO","Container","Main","InputGroup","Debit","FormGroup","ButtonGroup","Loading","Title","Table","Header","Aside","Input","Button","api","getValidationErrors","prettyDate","formatCoin","ExtraDebitsByContract","formRef","contract_id","debits","setDebits","selectedDebit","setSelectedDebit","payment","setPayment","loadingPage","setLoadingPage","loadingSubmit","setLoadingSubmit","handleEditExtraDebit","contracts_ids","description","discount","payment_limit_date","value","current","setErrors","validateFormData","Yup","object","shape","string","required","number","typeError","date","validate","abortEarly","selectedContracts","Object","entries","promises","forEach","selected","push","post","Promise","all","success","err","ValidationError","errors","error","response","data","message","get","then","debitsFromApi","debit","parsedDebitDate","toString","true_value","months","Date","assign","catch","finally","length","map","paid","id","payday"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Form } from '@unform/web';\nimport { FormHandles } from '@unform/core';\nimport {\n  FiCalendar,\n  FiDollarSign,\n  FiFileText,\n  FiPercent,\n} from 'react-icons/fi';\nimport { ValidationError as YupValidationError } from 'yup';\nimport { toast } from 'react-toastify';\nimport { isPast, differenceInCalendarMonths, parseISO } from 'date-fns';\n\nimport {\n  Container,\n  Main,\n  InputGroup,\n  Debit,\n  FormGroup,\n  ButtonGroup,\n} from './styles';\nimport { paymentMethods } from '../../utils/defaults';\nimport Loading from '../../components/Loading';\nimport Title from '../../components/Title';\nimport Table from '../../components/Table';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Input from '../../components/Input';\nimport Select from '../../components/SelectInput';\nimport Button from '../../components/Button';\nimport Popup from '../../components/Popup';\nimport Document from '../../components/Document';\nimport IDebit from '../../entities/IDebit';\nimport IPayment from '../../entities/IPayment';\nimport api from '../../services/api';\nimport paymentSchema from '../../schemas/paymentSchema';\nimport getValidationErrors from '../../utils/getValidationErrors';\nimport { prettyDate, formatCoin } from '../../utils/formatFunctions';\n\ninterface IFormData {\n  method: 'creditCard' | 'debitCard' | 'cash' | 'check' | 'deposit' | 'slip';\n}\n\ninterface IParams {\n  contract_id: string;\n}\n\ninterface IDebitWithVariation extends IDebit {\n  true_value?: number;\n}\n\nconst ExtraDebitsByContract: React.FC = () => {\n  const formRef = useRef<FormHandles>(null);\n\n  const { contract_id } = useParams<IParams>();\n\n  const [debits, setDebits] = useState([] as IDebitWithVariation[]);\n  const [selectedDebit, setSelectedDebit] = useState({} as IDebitWithVariation);\n  const [payment, setPayment] = useState({} as IPayment);\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n\n  const handleEditExtraDebit = useCallback(\n    async ({\n      contracts_ids,\n      description,\n      discount,\n      payment_limit_date,\n      value,\n    }: IFormData) => {\n      try {\n        setLoadingSubmit(true);\n\n        formRef.current?.setErrors({});\n\n        const validateFormData = Yup.object().shape({\n          description: Yup.string().required('Descrião obrigatória'),\n          discount: Yup.number().typeError(\n            () => 'Desconto precisa ser numérico',\n          ),\n          payment_limit_date: Yup.date()\n            .typeError(() => 'Deata inválida')\n            .required(),\n          value: Yup.number()\n            .typeError(() => 'O valor precisa ser numérico')\n            .required(),\n        });\n\n        await validateFormData.validate(\n          {\n            description,\n            discount,\n            payment_limit_date,\n            value,\n          },\n          { abortEarly: false },\n        );\n\n        const selectedContracts = Object.entries(contracts_ids);\n\n        const promises = [] as Promise<AxiosResponse>[];\n\n        selectedContracts.forEach(([contract_id, selected]) => {\n          if (selected) {\n            promises.push(\n              api.post('/debits/extra', {\n                contract_id,\n                description,\n                discount,\n                payment_limit_date,\n                value,\n              }),\n            );\n          }\n        });\n\n        await Promise.all(promises);\n\n        toast.success('Débitos criados com sucesso!');\n      } catch (err) {\n        if (err instanceof Yup.ValidationError) {\n          const errors = getValidationErrors(err);\n          formRef.current?.setErrors(errors);\n          toast.error(\n            'Oops... alguns dados não foram preenchidos corretamente!',\n          );\n          return;\n        }\n\n        if (err.response) {\n          toast.error(`Erro ao criar débito: ${err.response.data.message}`);\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n          );\n        }\n      } finally {\n        setLoadingSubmit(false);\n      }\n    },\n    [],\n  );\n\n  useEffect(() => {\n    setLoadingPage(true);\n    api\n      .get(`contracts/${contract_id}/debits/extra`)\n      .then(response => {\n        const debitsFromApi = response.data;\n\n        debitsFromApi.forEach((debit: IDebitWithVariation) => {\n          const parsedDebitDate = parseISO(debit.payment_limit_date.toString());\n\n          let true_value = debit.value;\n\n          if (isPast(parsedDebitDate)) {\n            const months = differenceInCalendarMonths(\n              new Date(),\n              parsedDebitDate,\n            );\n\n            true_value = debit.value * 1.03 ** months;\n          } else {\n            true_value = debit.value - (debit.value * debit.discount) / 100;\n          }\n\n          Object.assign(debit, { true_value });\n        });\n\n        setDebits(response.data);\n      })\n      .catch(() => {\n        toast.error(\n          'Erro ao carregar débitos! Por favor, tente novamente mais tarde.',\n        );\n      })\n      .finally(() => {\n        setLoadingPage(false);\n      });\n  }, [contract_id]);\n\n  return (\n    <Container>\n      <Loading show={loadingPage} />\n\n      <Header />\n\n      <Aside />\n\n      <Main>\n        <Title\n          title=\"Gerenciar débitos adicionais\"\n          subtitle={`Contrato #${contract_id}`}\n        />\n\n        <Form ref={formRef} onSubmit={handleEditExtraDebit}>\n          <FormGroup>\n            <InputGroup>\n              <Input\n                icon={FiFileText}\n                name=\"description\"\n                placeholder=\"Descrição\"\n              />\n\n              <Input\n                icon={FiDollarSign}\n                type=\"number\"\n                step=\"0.01\"\n                name=\"value\"\n                placeholder=\"Valor\"\n              />\n            </InputGroup>\n\n            <InputGroup>\n              <Input\n                icon={FiPercent}\n                type=\"number\"\n                step=\"0.01\"\n                name=\"discount\"\n                placeholder=\"Desconto\"\n              />\n\n              <Input\n                icon={FiCalendar}\n                type=\"date\"\n                name=\"payment_limit_date\"\n                label=\"Data limite de pagamento\"\n              />\n            </InputGroup>\n\n            <ButtonGroup>\n              <Button type=\"submit\">Editar</Button>\n              <Button type=\"button\">Cancelar</Button>\n            </ButtonGroup>\n          </FormGroup>\n        </Form>\n\n        <Table\n          isVoid={debits.length <= 0}\n          voidMessage=\"Não há débitos para serem pagos!\"\n        >\n          <thead>\n            <tr>\n              <td>Descrição</td>\n              <td>Valor</td>\n              <td>Valor com variação</td>\n              <td>Data limite do pagamento</td>\n              <td>Data de pagamento</td>\n              <td>Ações</td>\n            </tr>\n          </thead>\n          <tbody>\n            {debits.map(debit => (\n              <Debit\n                paid={debit.paid}\n                key={debit.id}\n                onClick={() => setSelectedDebit(debit)}\n              >\n                <td>{debit.description}</td>\n                <td>{formatCoin(debit.value)}</td>\n                <td>\n                  {debit.true_value\n                    ? formatCoin(debit.true_value)\n                    : debit.value}\n                </td>\n                <td>{prettyDate(debit.payment_limit_date)}</td>\n                <td>{debit.payday ? prettyDate(debit.payday) : '-'}</td>\n                <td>Botões</td>\n              </Debit>\n            ))}\n          </tbody>\n        </Table>\n      </Main>\n    </Container>\n  );\n};\n\nexport default ExtraDebitsByContract;\n"]},"metadata":{},"sourceType":"module"}