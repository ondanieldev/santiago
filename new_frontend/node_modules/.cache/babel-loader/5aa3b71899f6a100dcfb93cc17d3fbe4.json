{"ast":null,"code":"var _jsxFileName = \"/home/ondaniel/santiago/main/new_frontend/src/pages/Users/index.tsx\";\nimport React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { Form } from '@unform/web';\nimport { FiUser, FiBriefcase, FiLock, FiEdit2 } from 'react-icons/fi';\nimport { ValidationError as YupValidationError } from 'yup';\nimport { toast } from 'react-toastify';\nimport { Container, Main, ButtonGroup, DoubleColumn } from './styles';\nimport Loading from '../../components/Loading';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Title from '../../components/Title';\nimport Input from '../../components/Input';\nimport Select from '../../components/Select';\nimport Button from '../../components/Button';\nimport UsersList from '../../components/List';\nimport api from '../../services/api';\nimport userSchema from '../../schemas/userSchema';\nimport getValidationErrors from '../../utils/getValidationErrors';\n\nconst Users = () => {\n  const formRef = useRef(null);\n  const [users, setUsers] = useState([]);\n  const [profiles, setProfiles] = useState([]);\n  const [userId, setUserId] = useState('');\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n  useEffect(() => {\n    setLoadingPage(true);\n    api.get('/users').then(response => setUsers(response.data)).catch(() => {\n      toast.error('Erro ao carregar usuários! Por favor, tente novamente mais tarde.');\n    }).finally(() => {\n      setLoadingPage(false);\n    });\n  }, []);\n  useEffect(() => {\n    api.get('/profiles').then(response => setProfiles(response.data)).catch(() => {\n      toast.error('Erro ao carregar perfis! Por favor, tente novamente mais tarde.');\n    });\n  }, []);\n  const handleGetUser = useCallback(data => {\n    var _formRef$current, _formRef$current2;\n\n    setUserId(data.id);\n    (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n    (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setData(data);\n  }, []);\n  const handleUngetUser = useCallback(() => {\n    var _formRef$current3, _formRef$current4;\n\n    setUserId('');\n    (_formRef$current3 = formRef.current) === null || _formRef$current3 === void 0 ? void 0 : _formRef$current3.setErrors({});\n    (_formRef$current4 = formRef.current) === null || _formRef$current4 === void 0 ? void 0 : _formRef$current4.reset();\n  }, []);\n  const handleAddUser = useCallback(async (data, {\n    reset\n  }) => {\n    if (loadingSubmit) {\n      return;\n    }\n\n    setLoadingSubmit(true);\n\n    try {\n      var _formRef$current5;\n\n      (_formRef$current5 = formRef.current) === null || _formRef$current5 === void 0 ? void 0 : _formRef$current5.setErrors({});\n      await userSchema.validate(data, {\n        abortEarly: false\n      });\n      const response = await api.post('/users', data);\n      setUsers([...users, response.data]);\n      reset();\n      toast.success('Usuário criado com sucesso!');\n    } catch (err) {\n      if (err instanceof YupValidationError) {\n        var _formRef$current6;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current6 = formRef.current) === null || _formRef$current6 === void 0 ? void 0 : _formRef$current6.setErrors(errors);\n        return;\n      }\n\n      if (err.response) {\n        toast.error(`Erro ao criar usuário: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');\n      }\n    } finally {\n      setLoadingSubmit(false);\n    }\n  }, [users, loadingSubmit]);\n  const handleUpdateUser = useCallback(async (data, {\n    reset\n  }) => {\n    if (loadingSubmit) {\n      return;\n    }\n\n    setLoadingSubmit(true);\n\n    try {\n      var _formRef$current7;\n\n      (_formRef$current7 = formRef.current) === null || _formRef$current7 === void 0 ? void 0 : _formRef$current7.setErrors({});\n      await userSchema.validate(data, {\n        abortEarly: false\n      });\n      const response = await api.put(`/users/${userId}`, data);\n      const usersWithoutEdited = users.filter(user => user.id !== userId);\n      setUsers([...usersWithoutEdited, response.data]);\n      setUserId('');\n      reset();\n      toast.success('Usuário atualizado com sucesso!');\n    } catch (err) {\n      if (err instanceof YupValidationError) {\n        var _formRef$current8;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current8 = formRef.current) === null || _formRef$current8 === void 0 ? void 0 : _formRef$current8.setErrors(errors);\n        return;\n      }\n\n      if (err.response) {\n        toast.error(`Erro ao atualizar usuário: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');\n      }\n    } finally {\n      setLoadingSubmit(false);\n    }\n  }, [users, userId, loadingSubmit]);\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Loading, {\n    show: loadingPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Aside, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Main, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Title, {\n    title: \"Gerenciar usu\\xE1rios\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(DoubleColumn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    ref: formRef,\n    onSubmit: !userId ? handleAddUser : handleUpdateUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Usu\\xE1rio\",\n    name: \"username\",\n    icon: FiUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Senha\",\n    name: \"password\",\n    type: \"password\",\n    icon: FiLock,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Select, {\n    name: \"profile_id\",\n    icon: FiBriefcase,\n    defaultValue: \"null\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"option\", {\n    value: \"null\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 15\n    }\n  }, \"Selecionar perfil\"), profiles.map(profile => /*#__PURE__*/React.createElement(\"option\", {\n    key: profile.id,\n    value: profile.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 17\n    }\n  }, profile.name))), /*#__PURE__*/React.createElement(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 13\n    }\n  }, !userId ? /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    loading: loadingSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 17\n    }\n  }, \"Adicionar\") : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    loading: loadingSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 19\n    }\n  }, \"Atualizar\"), /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    backgroundColor: \"#f44336\",\n    onClick: handleUngetUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 19\n    }\n  }, \"Cancelar\")))), users.length > 0 && /*#__PURE__*/React.createElement(UsersList, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 13\n    }\n  }, users.map(user => /*#__PURE__*/React.createElement(\"li\", {\n    key: user.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FiEdit2, {\n    size: 20,\n    onClick: () => handleGetUser(user),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 19\n    }\n  }, user.username)))))));\n};\n\nexport default Users;","map":{"version":3,"sources":["/home/ondaniel/santiago/main/new_frontend/src/pages/Users/index.tsx"],"names":["React","useState","useCallback","useEffect","useRef","Form","FiUser","FiBriefcase","FiLock","FiEdit2","ValidationError","YupValidationError","toast","Container","Main","ButtonGroup","DoubleColumn","Loading","Header","Aside","Title","Input","Select","Button","UsersList","api","userSchema","getValidationErrors","Users","formRef","users","setUsers","profiles","setProfiles","userId","setUserId","loadingPage","setLoadingPage","loadingSubmit","setLoadingSubmit","get","then","response","data","catch","error","finally","handleGetUser","id","current","setErrors","setData","handleUngetUser","reset","handleAddUser","validate","abortEarly","post","success","err","errors","message","handleUpdateUser","put","usersWithoutEdited","filter","user","map","profile","name","length","username"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { FormHandles } from '@unform/core';\nimport { Form } from '@unform/web';\nimport { FiUser, FiBriefcase, FiLock, FiEdit2 } from 'react-icons/fi';\nimport { ValidationError as YupValidationError } from 'yup';\nimport { toast } from 'react-toastify';\n\nimport { Container, Main, ButtonGroup, DoubleColumn } from './styles';\nimport Loading from '../../components/Loading';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Title from '../../components/Title';\nimport Input from '../../components/Input';\nimport Select from '../../components/Select';\nimport Button from '../../components/Button';\nimport UsersList from '../../components/List';\nimport IUser from '../../entities/IUser';\nimport IProfile from '../../entities/IProfile';\nimport api from '../../services/api';\nimport userSchema from '../../schemas/userSchema';\nimport getValidationErrors from '../../utils/getValidationErrors';\n\nconst Users: React.FC = () => {\n  const formRef = useRef<FormHandles>(null);\n\n  const [users, setUsers] = useState([] as IUser[]);\n  const [profiles, setProfiles] = useState([] as IProfile[]);\n  const [userId, setUserId] = useState('');\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n\n  useEffect(() => {\n    setLoadingPage(true);\n    api\n      .get('/users')\n      .then(response => setUsers(response.data))\n      .catch(() => {\n        toast.error(\n          'Erro ao carregar usuários! Por favor, tente novamente mais tarde.',\n        );\n      })\n      .finally(() => {\n        setLoadingPage(false);\n      });\n  }, []);\n\n  useEffect(() => {\n    api\n      .get('/profiles')\n      .then(response => setProfiles(response.data))\n      .catch(() => {\n        toast.error(\n          'Erro ao carregar perfis! Por favor, tente novamente mais tarde.',\n        );\n      });\n  }, []);\n\n  const handleGetUser = useCallback((data: Omit<IUser, 'profile'>) => {\n    setUserId(data.id);\n\n    formRef.current?.setErrors({});\n\n    formRef.current?.setData(data);\n  }, []);\n\n  const handleUngetUser = useCallback(() => {\n    setUserId('');\n\n    formRef.current?.setErrors({});\n\n    formRef.current?.reset();\n  }, []);\n\n  const handleAddUser = useCallback(\n    async (data: Omit<IUser, 'id' | 'profile'>, { reset }) => {\n      if (loadingSubmit) {\n        return;\n      }\n\n      setLoadingSubmit(true);\n\n      try {\n        formRef.current?.setErrors({});\n\n        await userSchema.validate(data, {\n          abortEarly: false,\n        });\n\n        const response = await api.post('/users', data);\n\n        setUsers([...users, response.data]);\n\n        reset();\n\n        toast.success('Usuário criado com sucesso!');\n      } catch (err) {\n        if (err instanceof YupValidationError) {\n          const errors = getValidationErrors(err);\n          formRef.current?.setErrors(errors);\n          return;\n        }\n\n        if (err.response) {\n          toast.error(`Erro ao criar usuário: ${err.response.data.message}`);\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n          );\n        }\n      } finally {\n        setLoadingSubmit(false);\n      }\n    },\n    [users, loadingSubmit],\n  );\n\n  const handleUpdateUser = useCallback(\n    async (data: Omit<IUser, 'id' | 'profile'>, { reset }) => {\n      if (loadingSubmit) {\n        return;\n      }\n\n      setLoadingSubmit(true);\n\n      try {\n        formRef.current?.setErrors({});\n\n        await userSchema.validate(data, {\n          abortEarly: false,\n        });\n\n        const response = await api.put(`/users/${userId}`, data);\n\n        const usersWithoutEdited = users.filter(user => user.id !== userId);\n\n        setUsers([...usersWithoutEdited, response.data]);\n\n        setUserId('');\n\n        reset();\n\n        toast.success('Usuário atualizado com sucesso!');\n      } catch (err) {\n        if (err instanceof YupValidationError) {\n          const errors = getValidationErrors(err);\n          formRef.current?.setErrors(errors);\n          return;\n        }\n\n        if (err.response) {\n          toast.error(\n            `Erro ao atualizar usuário: ${err.response.data.message}`,\n          );\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n          );\n        }\n      } finally {\n        setLoadingSubmit(false);\n      }\n    },\n    [users, userId, loadingSubmit],\n  );\n\n  return (\n    <Container>\n      <Loading show={loadingPage} />\n\n      <Header />\n\n      <Aside />\n\n      <Main>\n        <Title title=\"Gerenciar usuários\" />\n\n        <DoubleColumn>\n          <Form\n            ref={formRef}\n            onSubmit={!userId ? handleAddUser : handleUpdateUser}\n          >\n            <Input placeholder=\"Usuário\" name=\"username\" icon={FiUser} />\n\n            <Input\n              placeholder=\"Senha\"\n              name=\"password\"\n              type=\"password\"\n              icon={FiLock}\n            />\n\n            <Select name=\"profile_id\" icon={FiBriefcase} defaultValue=\"null\">\n              <option value=\"null\">Selecionar perfil</option>\n              {profiles.map(profile => (\n                <option key={profile.id} value={profile.id}>\n                  {profile.name}\n                </option>\n              ))}\n            </Select>\n\n            <ButtonGroup>\n              {!userId ? (\n                <Button type=\"submit\" loading={loadingSubmit}>\n                  Adicionar\n                </Button>\n              ) : (\n                <>\n                  <Button type=\"submit\" loading={loadingSubmit}>\n                    Atualizar\n                  </Button>\n\n                  <Button\n                    type=\"submit\"\n                    backgroundColor=\"#f44336\"\n                    onClick={handleUngetUser}\n                  >\n                    Cancelar\n                  </Button>\n                </>\n              )}\n            </ButtonGroup>\n          </Form>\n\n          {users.length > 0 && (\n            <UsersList>\n              {users.map(user => (\n                <li key={user.id}>\n                  <FiEdit2 size={20} onClick={() => handleGetUser(user)} />\n                  {/* <FiTrash\n                    size={20}\n                    onClick={() => handleRemoveUser(user.id)}\n                  /> */}\n                  <span>{user.username}</span>\n                </li>\n              ))}\n            </UsersList>\n          )}\n        </DoubleColumn>\n      </Main>\n    </Container>\n  );\n};\n\nexport default Users;\n"]},"metadata":{},"sourceType":"module"}