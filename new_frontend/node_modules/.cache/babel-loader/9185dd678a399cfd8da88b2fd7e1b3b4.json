{"ast":null,"code":"var _jsxFileName = \"/home/ondaniel/santiago/main/new_frontend/src/pages/ExtraDebitsByContract/index.tsx\";\nimport React, { useEffect, useState, useCallback, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Form } from '@unform/web';\nimport { FiCalendar, FiDollarSign, FiFileText, FiPercent, FiEdit2, FiTrash, FiCheck } from 'react-icons/fi';\nimport * as Yup from 'yup';\nimport { toast } from 'react-toastify';\nimport { isPast, differenceInCalendarMonths, parseISO } from 'date-fns';\nimport { Container, Main, InputGroup, Debit, FormGroup, ButtonGroup, ActionGroup, WarnMessage } from './styles';\nimport Loading from '../../components/Loading';\nimport Title from '../../components/Title';\nimport Table from '../../components/Table';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Input from '../../components/Input';\nimport Button from '../../components/Button';\nimport Popup from '../../components/Popup';\nimport api from '../../services/api';\nimport getValidationErrors from '../../utils/getValidationErrors';\nimport { prettyDate, formatCoin } from '../../utils/formatFunctions';\nimport Checkbox from '../../components/Checkbox';\n\nconst ExtraDebitsByContract = () => {\n  const formRef = useRef(null);\n  const {\n    contract_id\n  } = useParams();\n  const [debits, setDebits] = useState([]);\n  const [selectedEditDebit, setSelectedEditDebit] = useState('');\n  const [selectedDeleteDebit, setSelectedDeleteDebit] = useState('');\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n  const [confirmMessage, setConfirmMessage] = useState('');\n  const handleSelectEditExtraDebit = useCallback(debit => {\n    var _formRef$current, _formRef$current2, _formRef$current3, _formRef$current4, _formRef$current5;\n\n    setSelectedEditDebit(debit.id);\n    (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n    (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setFieldValue('description', debit.description);\n    (_formRef$current3 = formRef.current) === null || _formRef$current3 === void 0 ? void 0 : _formRef$current3.setFieldValue('value', debit.value);\n    (_formRef$current4 = formRef.current) === null || _formRef$current4 === void 0 ? void 0 : _formRef$current4.setFieldValue('discount', debit.discount);\n    (_formRef$current5 = formRef.current) === null || _formRef$current5 === void 0 ? void 0 : _formRef$current5.setFieldValue('payment_limit_date', debit.payment_limit_date);\n  }, []);\n  const handleUnselectExtraDebit = useCallback(() => {\n    var _formRef$current6, _formRef$current7;\n\n    setSelectedEditDebit('');\n    setSelectedDeleteDebit('');\n    (_formRef$current6 = formRef.current) === null || _formRef$current6 === void 0 ? void 0 : _formRef$current6.setErrors({});\n    (_formRef$current7 = formRef.current) === null || _formRef$current7 === void 0 ? void 0 : _formRef$current7.reset();\n  }, []);\n  const handleSelectDeleteExtraDebit = useCallback(deibt_id => {\n    setSelectedDeleteDebit(deibt_id);\n  }, []);\n  const calcTrueValue = useCallback(debit => {\n    const parsedDebitDate = parseISO(debit.payment_limit_date.toString());\n    let true_value = debit.value;\n\n    if (isPast(parsedDebitDate) && debit.apply_interest_rules) {\n      const months = differenceInCalendarMonths(new Date(), parsedDebitDate);\n      true_value = debit.value * 1.03 ** months;\n    } else if (!isPast(parsedDebitDate)) {\n      true_value = debit.value - debit.value * debit.discount / 100;\n    }\n\n    return true_value;\n  }, []);\n  const handleEditExtraDebit = useCallback(async ({\n    description,\n    discount,\n    payment_limit_date,\n    value,\n    apply_interest_rules\n  }) => {\n    try {\n      var _formRef$current8, _formRef$current9;\n\n      setLoadingSubmit(true);\n      (_formRef$current8 = formRef.current) === null || _formRef$current8 === void 0 ? void 0 : _formRef$current8.setErrors({});\n      const validateFormData = Yup.object().shape({\n        description: Yup.string().required('Descrião obrigatória'),\n        discount: Yup.number().typeError(() => 'Desconto precisa ser numérico'),\n        payment_limit_date: Yup.date().typeError(() => 'Deata inválida').required(),\n        value: Yup.number().typeError(() => 'O valor precisa ser numérico').required()\n      });\n      await validateFormData.validate({\n        description,\n        discount,\n        payment_limit_date,\n        value\n      }, {\n        abortEarly: false\n      });\n      const response = await api.put(`/debits/extra/${selectedEditDebit}`, {\n        description,\n        discount,\n        payment_limit_date,\n        value,\n        apply_interest_rules\n      });\n      const updatedDebit = response.data;\n      const true_value = calcTrueValue(updatedDebit);\n      Object.assign(updatedDebit, {\n        true_value\n      });\n      const debitsWithoutUpdated = debits.filter(debit => debit.id !== selectedEditDebit);\n      setDebits([...debitsWithoutUpdated, updatedDebit]);\n      (_formRef$current9 = formRef.current) === null || _formRef$current9 === void 0 ? void 0 : _formRef$current9.reset();\n      setSelectedEditDebit('');\n      toast.success('Débito editado com sucesso!');\n    } catch (err) {\n      if (err instanceof Yup.ValidationError) {\n        var _formRef$current10;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current10 = formRef.current) === null || _formRef$current10 === void 0 ? void 0 : _formRef$current10.setErrors(errors);\n        toast.error('Oops... alguns dados não foram preenchidos corretamente!');\n        return;\n      }\n\n      if (err.response) {\n        toast.error(`Erro ao editar débito: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');\n      }\n    } finally {\n      setLoadingSubmit(false);\n    }\n  }, [selectedEditDebit, calcTrueValue, debits]);\n  const handleClosePopup = useCallback(() => {\n    setSelectedDeleteDebit('');\n  }, []);\n  const handleDeleteExtraDebit = useCallback(async () => {\n    try {\n      setLoadingSubmit(true);\n      await api.delete(`/debits/extra/${selectedDeleteDebit}`);\n      setSelectedDeleteDebit('');\n      const debitsWithoutDeleted = debits.filter(debit => debit.id !== selectedDeleteDebit);\n      setDebits(debitsWithoutDeleted);\n      toast.success('Débito excluído com sucesso!');\n    } catch (err) {\n      if (err.response) {\n        toast.error(`Erro ao excluir débito: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');\n      }\n    }\n  }, [selectedDeleteDebit, debits]);\n  useEffect(() => {\n    setLoadingPage(true);\n    api.get(`contracts/${contract_id}/debits/extra`).then(response => {\n      const debitsFromApi = response.data;\n      debitsFromApi.forEach(debit => {\n        const true_value = calcTrueValue(debit);\n        Object.assign(debit, {\n          true_value\n        });\n      });\n      setDebits(response.data);\n    }).catch(() => {\n      toast.error('Erro ao carregar débitos! Por favor, tente novamente mais tarde.');\n    }).finally(() => {\n      setLoadingPage(false);\n    });\n  }, [contract_id, calcTrueValue]);\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Loading, {\n    show: loadingPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Aside, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Main, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Title, {\n    title: \"Gerenciar d\\xE9bitos adicionais\",\n    subtitle: `Contrato #${contract_id}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Form, {\n    ref: formRef,\n    onSubmit: handleEditExtraDebit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(FormGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    icon: FiFileText,\n    name: \"description\",\n    placeholder: \"Descri\\xE7\\xE3o\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    icon: FiDollarSign,\n    type: \"number\",\n    step: \"0.01\",\n    name: \"value\",\n    placeholder: \"Valor\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    icon: FiPercent,\n    type: \"number\",\n    step: \"0.01\",\n    name: \"discount\",\n    placeholder: \"Desconto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    icon: FiCalendar,\n    type: \"date\",\n    name: \"payment_limit_date\",\n    label: \"Data limite de pagamento\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Checkbox, {\n    name: \"apply_interest_rules\",\n    label: \"Aplicar regras de juros\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 15\n    }\n  })), selectedEditDebit && /*#__PURE__*/React.createElement(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    loading: loadingSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 17\n    }\n  }, \"Editar\"), /*#__PURE__*/React.createElement(Button, {\n    type: \"button\",\n    backgroundColor: \"#f44336\",\n    onClick: handleUnselectExtraDebit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 17\n    }\n  }, \"Cancelar\")))), /*#__PURE__*/React.createElement(Table, {\n    isVoid: debits.length <= 0,\n    voidMessage: \"N\\xE3o h\\xE1 d\\xE9bitos para serem pagos!\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"thead\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 15\n    }\n  }, \"Descri\\xE7\\xE3o\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 15\n    }\n  }, \"Valor\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 15\n    }\n  }, \"Valor com varia\\xE7\\xE3o\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 15\n    }\n  }, \"Data limite do pagamento\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 15\n    }\n  }, \"A\\xE7\\xF5es\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 11\n    }\n  }, debits.map(debit => /*#__PURE__*/React.createElement(Debit, {\n    paid: debit.paid,\n    key: debit.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 17\n    }\n  }, debit.description), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 17\n    }\n  }, formatCoin(debit.value)), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 17\n    }\n  }, typeof debit.true_value === 'number' ? formatCoin(debit.true_value) : formatCoin(debit.value)), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 17\n    }\n  }, prettyDate(debit.payment_limit_date)), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(ActionGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(FiEdit2, {\n    onClick: () => handleSelectEditExtraDebit(debit),\n    size: 20,\n    color: \"#212529\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(FiTrash, {\n    onClick: () => handleSelectDeleteExtraDebit(debit.id),\n    size: 20,\n    color: \"#f44336\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 21\n    }\n  }))))))), selectedDeleteDebit && /*#__PURE__*/React.createElement(Popup, {\n    title: \"Deletar d\\xE9bito\",\n    handleClosePopup: handleClosePopup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    onSubmit: handleDeleteExtraDebit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(WarnMessage, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 17\n    }\n  }, \" ATEN\\xC7\\xC3O: \"), \"esta a\\xE7\\xE3o n\\xE3o pode ser desfeita! Digite\", /*#__PURE__*/React.createElement(\"b\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 17\n    }\n  }, \" CONFIRMAR \"), \"para deletar o d\\xE9bito.\"), /*#__PURE__*/React.createElement(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    name: \"confirm_message\",\n    icon: FiCheck,\n    value: confirmMessage,\n    onChange: e => setConfirmMessage(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 397,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    disabled: confirmMessage !== 'CONFIRMAR',\n    type: \"submit\",\n    loading: loadingSubmit,\n    backgroundColor: \"#f44336\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 17\n    }\n  }, \"Deletar\"))))));\n};\n\nexport default ExtraDebitsByContract;","map":{"version":3,"sources":["/home/ondaniel/santiago/main/new_frontend/src/pages/ExtraDebitsByContract/index.tsx"],"names":["React","useEffect","useState","useCallback","useRef","useParams","Form","FiCalendar","FiDollarSign","FiFileText","FiPercent","FiEdit2","FiTrash","FiCheck","Yup","toast","isPast","differenceInCalendarMonths","parseISO","Container","Main","InputGroup","Debit","FormGroup","ButtonGroup","ActionGroup","WarnMessage","Loading","Title","Table","Header","Aside","Input","Button","Popup","api","getValidationErrors","prettyDate","formatCoin","Checkbox","ExtraDebitsByContract","formRef","contract_id","debits","setDebits","selectedEditDebit","setSelectedEditDebit","selectedDeleteDebit","setSelectedDeleteDebit","loadingPage","setLoadingPage","loadingSubmit","setLoadingSubmit","confirmMessage","setConfirmMessage","handleSelectEditExtraDebit","debit","id","current","setErrors","setFieldValue","description","value","discount","payment_limit_date","handleUnselectExtraDebit","reset","handleSelectDeleteExtraDebit","deibt_id","calcTrueValue","parsedDebitDate","toString","true_value","apply_interest_rules","months","Date","handleEditExtraDebit","validateFormData","object","shape","string","required","number","typeError","date","validate","abortEarly","response","put","updatedDebit","data","Object","assign","debitsWithoutUpdated","filter","success","err","ValidationError","errors","error","message","handleClosePopup","handleDeleteExtraDebit","delete","debitsWithoutDeleted","get","then","debitsFromApi","forEach","catch","finally","length","map","paid","e","target"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Form } from '@unform/web';\nimport { FormHandles } from '@unform/core';\nimport {\n  FiCalendar,\n  FiDollarSign,\n  FiFileText,\n  FiPercent,\n  FiEdit2,\n  FiTrash,\n  FiCheck,\n} from 'react-icons/fi';\nimport * as Yup from 'yup';\nimport { toast } from 'react-toastify';\nimport { isPast, differenceInCalendarMonths, parseISO } from 'date-fns';\n\nimport {\n  Container,\n  Main,\n  InputGroup,\n  Debit,\n  FormGroup,\n  ButtonGroup,\n  ActionGroup,\n  WarnMessage,\n} from './styles';\nimport Loading from '../../components/Loading';\nimport Title from '../../components/Title';\nimport Table from '../../components/Table';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Input from '../../components/Input';\nimport Button from '../../components/Button';\nimport Popup from '../../components/Popup';\nimport IDebit from '../../entities/IDebit';\nimport api from '../../services/api';\nimport getValidationErrors from '../../utils/getValidationErrors';\nimport { prettyDate, formatCoin } from '../../utils/formatFunctions';\nimport Checkbox from '../../components/Checkbox';\n\ninterface IFormData {\n  method: 'creditCard' | 'debitCard' | 'cash' | 'check' | 'deposit' | 'slip';\n}\n\ninterface IDebitWithVariation extends IDebit {\n  true_value?: number;\n}\n\ninterface IParams {\n  contract_id: string;\n}\n\ninterface IFormData {\n  description: string;\n  discount: number;\n  payment_limit_date: Date;\n  select_all: boolean;\n  value: number;\n  apply_interest_rules: boolean;\n}\n\nconst ExtraDebitsByContract: React.FC = () => {\n  const formRef = useRef<FormHandles>(null);\n\n  const { contract_id } = useParams<IParams>();\n\n  const [debits, setDebits] = useState([] as IDebitWithVariation[]);\n  const [selectedEditDebit, setSelectedEditDebit] = useState('');\n  const [selectedDeleteDebit, setSelectedDeleteDebit] = useState('');\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n  const [confirmMessage, setConfirmMessage] = useState('');\n\n  const handleSelectEditExtraDebit = useCallback(\n    (debit: IDebitWithVariation) => {\n      setSelectedEditDebit(debit.id);\n\n      formRef.current?.setErrors({});\n\n      formRef.current?.setFieldValue('description', debit.description);\n      formRef.current?.setFieldValue('value', debit.value);\n      formRef.current?.setFieldValue('discount', debit.discount);\n      formRef.current?.setFieldValue(\n        'payment_limit_date',\n        debit.payment_limit_date,\n      );\n    },\n    [],\n  );\n\n  const handleUnselectExtraDebit = useCallback(() => {\n    setSelectedEditDebit('');\n    setSelectedDeleteDebit('');\n\n    formRef.current?.setErrors({});\n    formRef.current?.reset();\n  }, []);\n\n  const handleSelectDeleteExtraDebit = useCallback((deibt_id: string) => {\n    setSelectedDeleteDebit(deibt_id);\n  }, []);\n\n  const calcTrueValue = useCallback((debit: IDebitWithVariation): number => {\n    const parsedDebitDate = parseISO(debit.payment_limit_date.toString());\n\n    let true_value = debit.value;\n\n    if (isPast(parsedDebitDate) && debit.apply_interest_rules) {\n      const months = differenceInCalendarMonths(new Date(), parsedDebitDate);\n\n      true_value = debit.value * 1.03 ** months;\n    } else if (!isPast(parsedDebitDate)) {\n      true_value = debit.value - (debit.value * debit.discount) / 100;\n    }\n\n    return true_value;\n  }, []);\n\n  const handleEditExtraDebit = useCallback(\n    async ({\n      description,\n      discount,\n      payment_limit_date,\n      value,\n      apply_interest_rules,\n    }: IFormData) => {\n      try {\n        setLoadingSubmit(true);\n\n        formRef.current?.setErrors({});\n\n        const validateFormData = Yup.object().shape({\n          description: Yup.string().required('Descrião obrigatória'),\n          discount: Yup.number().typeError(\n            () => 'Desconto precisa ser numérico',\n          ),\n          payment_limit_date: Yup.date()\n            .typeError(() => 'Deata inválida')\n            .required(),\n          value: Yup.number()\n            .typeError(() => 'O valor precisa ser numérico')\n            .required(),\n        });\n\n        await validateFormData.validate(\n          {\n            description,\n            discount,\n            payment_limit_date,\n            value,\n          },\n          { abortEarly: false },\n        );\n\n        const response = await api.put(`/debits/extra/${selectedEditDebit}`, {\n          description,\n          discount,\n          payment_limit_date,\n          value,\n          apply_interest_rules,\n        });\n\n        const updatedDebit = response.data as IDebitWithVariation;\n\n        const true_value = calcTrueValue(updatedDebit);\n\n        Object.assign(updatedDebit, { true_value });\n\n        const debitsWithoutUpdated = debits.filter(\n          debit => debit.id !== selectedEditDebit,\n        );\n\n        setDebits([...debitsWithoutUpdated, updatedDebit]);\n\n        formRef.current?.reset();\n\n        setSelectedEditDebit('');\n\n        toast.success('Débito editado com sucesso!');\n      } catch (err) {\n        if (err instanceof Yup.ValidationError) {\n          const errors = getValidationErrors(err);\n          formRef.current?.setErrors(errors);\n          toast.error(\n            'Oops... alguns dados não foram preenchidos corretamente!',\n          );\n          return;\n        }\n\n        if (err.response) {\n          toast.error(`Erro ao editar débito: ${err.response.data.message}`);\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n          );\n        }\n      } finally {\n        setLoadingSubmit(false);\n      }\n    },\n    [selectedEditDebit, calcTrueValue, debits],\n  );\n\n  const handleClosePopup = useCallback(() => {\n    setSelectedDeleteDebit('');\n  }, []);\n\n  const handleDeleteExtraDebit = useCallback(async () => {\n    try {\n      setLoadingSubmit(true);\n\n      await api.delete(`/debits/extra/${selectedDeleteDebit}`);\n\n      setSelectedDeleteDebit('');\n\n      const debitsWithoutDeleted = debits.filter(\n        debit => debit.id !== selectedDeleteDebit,\n      );\n\n      setDebits(debitsWithoutDeleted);\n\n      toast.success('Débito excluído com sucesso!');\n    } catch (err) {\n      if (err.response) {\n        toast.error(`Erro ao excluir débito: ${err.response.data.message}`);\n      } else {\n        toast.error(\n          'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n        );\n      }\n    }\n  }, [selectedDeleteDebit, debits]);\n\n  useEffect(() => {\n    setLoadingPage(true);\n    api\n      .get(`contracts/${contract_id}/debits/extra`)\n      .then(response => {\n        const debitsFromApi = response.data;\n\n        debitsFromApi.forEach((debit: IDebitWithVariation) => {\n          const true_value = calcTrueValue(debit);\n\n          Object.assign(debit, { true_value });\n        });\n\n        setDebits(response.data);\n      })\n      .catch(() => {\n        toast.error(\n          'Erro ao carregar débitos! Por favor, tente novamente mais tarde.',\n        );\n      })\n      .finally(() => {\n        setLoadingPage(false);\n      });\n  }, [contract_id, calcTrueValue]);\n\n  return (\n    <Container>\n      <Loading show={loadingPage} />\n\n      <Header />\n\n      <Aside />\n\n      <Main>\n        <Title\n          title=\"Gerenciar débitos adicionais\"\n          subtitle={`Contrato #${contract_id}`}\n        />\n\n        <Form ref={formRef} onSubmit={handleEditExtraDebit}>\n          <FormGroup>\n            <InputGroup>\n              <Input\n                icon={FiFileText}\n                name=\"description\"\n                placeholder=\"Descrição\"\n              />\n\n              <Input\n                icon={FiDollarSign}\n                type=\"number\"\n                step=\"0.01\"\n                name=\"value\"\n                placeholder=\"Valor\"\n              />\n            </InputGroup>\n\n            <InputGroup>\n              <Input\n                icon={FiPercent}\n                type=\"number\"\n                step=\"0.01\"\n                name=\"discount\"\n                placeholder=\"Desconto\"\n              />\n\n              <Input\n                icon={FiCalendar}\n                type=\"date\"\n                name=\"payment_limit_date\"\n                label=\"Data limite de pagamento\"\n              />\n            </InputGroup>\n\n            <InputGroup>\n              <Checkbox\n                name=\"apply_interest_rules\"\n                label=\"Aplicar regras de juros\"\n              />\n            </InputGroup>\n\n            {selectedEditDebit && (\n              <ButtonGroup>\n                <Button type=\"submit\" loading={loadingSubmit}>\n                  Editar\n                </Button>\n\n                <Button\n                  type=\"button\"\n                  backgroundColor=\"#f44336\"\n                  onClick={handleUnselectExtraDebit}\n                >\n                  Cancelar\n                </Button>\n              </ButtonGroup>\n            )}\n          </FormGroup>\n        </Form>\n\n        <Table\n          isVoid={debits.length <= 0}\n          voidMessage=\"Não há débitos para serem pagos!\"\n        >\n          <thead>\n            <tr>\n              <td>Descrição</td>\n              <td>Valor</td>\n              <td>Valor com variação</td>\n              <td>Data limite do pagamento</td>\n              <td>Ações</td>\n            </tr>\n          </thead>\n          <tbody>\n            {debits.map(debit => (\n              <Debit paid={debit.paid} key={debit.id}>\n                <td>{debit.description}</td>\n                <td>{formatCoin(debit.value)}</td>\n                <td>\n                  {typeof debit.true_value === 'number'\n                    ? formatCoin(debit.true_value)\n                    : formatCoin(debit.value)}\n                </td>\n                <td>{prettyDate(debit.payment_limit_date)}</td>\n                <td>\n                  <ActionGroup>\n                    <FiEdit2\n                      onClick={() => handleSelectEditExtraDebit(debit)}\n                      size={20}\n                      color=\"#212529\"\n                    />\n\n                    <FiTrash\n                      onClick={() => handleSelectDeleteExtraDebit(debit.id)}\n                      size={20}\n                      color=\"#f44336\"\n                    />\n                  </ActionGroup>\n                </td>\n              </Debit>\n            ))}\n          </tbody>\n        </Table>\n\n        {selectedDeleteDebit && (\n          <Popup title=\"Deletar débito\" handleClosePopup={handleClosePopup}>\n            <Form onSubmit={handleDeleteExtraDebit}>\n              <WarnMessage>\n                <strong> ATENÇÃO: </strong>\n                esta ação não pode ser desfeita! Digite\n                <b> CONFIRMAR </b>\n                para deletar o débito.\n              </WarnMessage>\n\n              <InputGroup>\n                <Input\n                  name=\"confirm_message\"\n                  icon={FiCheck}\n                  value={confirmMessage}\n                  onChange={e => setConfirmMessage(e.target.value)}\n                />\n              </InputGroup>\n\n              <ButtonGroup>\n                <Button\n                  disabled={confirmMessage !== 'CONFIRMAR'}\n                  type=\"submit\"\n                  loading={loadingSubmit}\n                  backgroundColor=\"#f44336\"\n                >\n                  Deletar\n                </Button>\n              </ButtonGroup>\n            </Form>\n          </Popup>\n        )}\n      </Main>\n    </Container>\n  );\n};\n\nexport default ExtraDebitsByContract;\n"]},"metadata":{},"sourceType":"module"}