{"ast":null,"code":"var _jsxFileName = \"/home/ondaniel/santiago/sisgie-frontend/src/pages/Users/index.tsx\";\nimport React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { Form } from '@unform/web';\nimport { FiUser, FiBriefcase, FiLock, FiEdit2 } from 'react-icons/fi';\nimport { ValidationError as YupValidationError } from 'yup';\nimport { toast } from 'react-toastify';\nimport { Container, Main, ButtonGroup, DoubleColumn } from './styles';\nimport Loading from '../../components/Loading';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Title from '../../components/Title';\nimport Input from '../../components/Input';\nimport Select from '../../components/SelectInput';\nimport Button from '../../components/Button';\nimport UsersList from '../../components/List';\nimport api from '../../services/api';\nimport userSchema from '../../schemas/userSchema';\nimport getValidationErrors from '../../utils/getValidationErrors';\n\nconst Users = () => {\n  const formRef = useRef(null);\n  const [users, setUsers] = useState([]);\n  const [profiles, setProfiles] = useState([]);\n  const [userId, setUserId] = useState('');\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n  const [profilesOptions, setProfilesOptions] = useState([]);\n  useEffect(() => {\n    setLoadingPage(true);\n    api.get('/users').then(response => setUsers(response.data)).catch(() => {\n      toast.error('Erro ao carregar usuários! Por favor, tente novamente mais tarde.');\n    }).finally(() => {\n      setLoadingPage(false);\n    });\n  }, []);\n  useEffect(() => {\n    api.get('/profiles').then(response => {\n      setProfiles(response.data);\n      const options = profiles.map(profile => {\n        const option = {\n          label: profile.name,\n          value: profile.id\n        };\n        return option;\n      });\n      setProfilesOptions([{\n        label: 'Selecionar perfil',\n        value: 'null'\n      }, ...options]);\n    }).catch(() => {\n      toast.error('Erro ao carregar perfis! Por favor, tente novamente mais tarde.');\n    });\n  }, []);\n  const handleGetUser = useCallback(data => {\n    var _formRef$current, _formRef$current2;\n\n    setUserId(data.id);\n    (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n    (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setData(data);\n  }, []);\n  const handleUngetUser = useCallback(() => {\n    var _formRef$current3, _formRef$current4;\n\n    setUserId('');\n    (_formRef$current3 = formRef.current) === null || _formRef$current3 === void 0 ? void 0 : _formRef$current3.setErrors({});\n    (_formRef$current4 = formRef.current) === null || _formRef$current4 === void 0 ? void 0 : _formRef$current4.reset();\n  }, []);\n  const handleAddUser = useCallback(async (data, {\n    reset\n  }) => {\n    if (loadingSubmit) {\n      return;\n    }\n\n    setLoadingSubmit(true);\n\n    try {\n      var _formRef$current5;\n\n      (_formRef$current5 = formRef.current) === null || _formRef$current5 === void 0 ? void 0 : _formRef$current5.setErrors({});\n      await userSchema.validate(data, {\n        abortEarly: false\n      });\n      const response = await api.post('/users', data);\n      setUsers([...users, response.data]);\n      reset();\n      toast.success('Usuário criado com sucesso!');\n    } catch (err) {\n      if (err instanceof YupValidationError) {\n        var _formRef$current6;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current6 = formRef.current) === null || _formRef$current6 === void 0 ? void 0 : _formRef$current6.setErrors(errors);\n        return;\n      }\n\n      if (err.response) {\n        toast.error(`Erro ao criar usuário: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');\n      }\n    } finally {\n      setLoadingSubmit(false);\n    }\n  }, [users, loadingSubmit]);\n  const handleUpdateUser = useCallback(async (data, {\n    reset\n  }) => {\n    if (loadingSubmit) {\n      return;\n    }\n\n    setLoadingSubmit(true);\n\n    try {\n      var _formRef$current7;\n\n      (_formRef$current7 = formRef.current) === null || _formRef$current7 === void 0 ? void 0 : _formRef$current7.setErrors({});\n      await userSchema.validate(data, {\n        abortEarly: false\n      });\n      const response = await api.put(`/users/${userId}`, data);\n      const usersWithoutEdited = users.filter(user => user.id !== userId);\n      setUsers([...usersWithoutEdited, response.data]);\n      setUserId('');\n      reset();\n      toast.success('Usuário atualizado com sucesso!');\n    } catch (err) {\n      if (err instanceof YupValidationError) {\n        var _formRef$current8;\n\n        const errors = getValidationErrors(err);\n        (_formRef$current8 = formRef.current) === null || _formRef$current8 === void 0 ? void 0 : _formRef$current8.setErrors(errors);\n        return;\n      }\n\n      if (err.response) {\n        toast.error(`Erro ao atualizar usuário: ${err.response.data.message}`);\n      } else {\n        toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');\n      }\n    } finally {\n      setLoadingSubmit(false);\n    }\n  }, [users, userId, loadingSubmit]);\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Loading, {\n    show: loadingPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Aside, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Main, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Title, {\n    title: \"Gerenciar usu\\xE1rios\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(DoubleColumn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    ref: formRef,\n    onSubmit: !userId ? handleAddUser : handleUpdateUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Usu\\xE1rio\",\n    name: \"username\",\n    icon: FiUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"Senha\",\n    name: \"password\",\n    type: \"password\",\n    icon: FiLock,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Select, {\n    name: \"profile_id\",\n    icon: FiBriefcase,\n    defaultValue: \"null\",\n    optionsArray: profilesOptions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 13\n    }\n  }, !userId ? /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    loading: loadingSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 17\n    }\n  }, \"Adicionar\") : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    loading: loadingSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 19\n    }\n  }, \"Atualizar\"), /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    backgroundColor: \"#f44336\",\n    onClick: handleUngetUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 19\n    }\n  }, \"Cancelar\")))), users.length > 0 && /*#__PURE__*/React.createElement(UsersList, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 13\n    }\n  }, users.map(user => /*#__PURE__*/React.createElement(\"li\", {\n    key: user.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FiEdit2, {\n    size: 20,\n    onClick: () => handleGetUser(user),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 19\n    }\n  }, user.username)))))));\n};\n\nexport default Users;","map":{"version":3,"sources":["/home/ondaniel/santiago/sisgie-frontend/src/pages/Users/index.tsx"],"names":["React","useState","useCallback","useEffect","useRef","Form","FiUser","FiBriefcase","FiLock","FiEdit2","ValidationError","YupValidationError","toast","Container","Main","ButtonGroup","DoubleColumn","Loading","Header","Aside","Title","Input","Select","Button","UsersList","api","userSchema","getValidationErrors","Users","formRef","users","setUsers","profiles","setProfiles","userId","setUserId","loadingPage","setLoadingPage","loadingSubmit","setLoadingSubmit","profilesOptions","setProfilesOptions","get","then","response","data","catch","error","finally","options","map","profile","option","label","name","value","id","handleGetUser","current","setErrors","setData","handleUngetUser","reset","handleAddUser","validate","abortEarly","post","success","err","errors","message","handleUpdateUser","put","usersWithoutEdited","filter","user","length","username"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { FormHandles } from '@unform/core';\nimport { Form } from '@unform/web';\nimport { FiUser, FiBriefcase, FiLock, FiEdit2 } from 'react-icons/fi';\nimport { ValidationError as YupValidationError } from 'yup';\nimport { toast } from 'react-toastify';\n\nimport { Container, Main, ButtonGroup, DoubleColumn } from './styles';\nimport Loading from '../../components/Loading';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Title from '../../components/Title';\nimport Input from '../../components/Input';\nimport Select from '../../components/SelectInput';\nimport Button from '../../components/Button';\nimport UsersList from '../../components/List';\nimport IUser from '../../entities/IUser';\nimport IProfile from '../../entities/IProfile';\nimport api from '../../services/api';\nimport userSchema from '../../schemas/userSchema';\nimport getValidationErrors from '../../utils/getValidationErrors';\nimport { IOption } from '../../utils/defaults';\n\nconst Users: React.FC = () => {\n  const formRef = useRef<FormHandles>(null);\n\n  const [users, setUsers] = useState([] as IUser[]);\n  const [profiles, setProfiles] = useState([] as IProfile[]);\n  const [userId, setUserId] = useState('');\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n  const [profilesOptions, setProfilesOptions] = useState<IOption[]>([]);\n\n  useEffect(() => {\n    setLoadingPage(true);\n    api\n      .get('/users')\n      .then(response => setUsers(response.data))\n      .catch(() => {\n        toast.error(\n          'Erro ao carregar usuários! Por favor, tente novamente mais tarde.',\n        );\n      })\n      .finally(() => {\n        setLoadingPage(false);\n      });\n  }, []);\n\n  useEffect(() => {\n    api\n      .get('/profiles')\n      .then(response => {\n        setProfiles(response.data);\n\n        const options = profiles.map(profile => {\n          const option = { label: profile.name, value: profile.id } as IOption;\n          return option;\n        });\n\n        setProfilesOptions([\n          { label: 'Selecionar perfil', value: 'null' },\n          ...options,\n        ]);\n      })\n      .catch(() => {\n        toast.error(\n          'Erro ao carregar perfis! Por favor, tente novamente mais tarde.',\n        );\n      });\n  }, []);\n\n  const handleGetUser = useCallback((data: Omit<IUser, 'profile'>) => {\n    setUserId(data.id);\n\n    formRef.current?.setErrors({});\n\n    formRef.current?.setData(data);\n  }, []);\n\n  const handleUngetUser = useCallback(() => {\n    setUserId('');\n\n    formRef.current?.setErrors({});\n\n    formRef.current?.reset();\n  }, []);\n\n  const handleAddUser = useCallback(\n    async (data: Omit<IUser, 'id' | 'profile'>, { reset }) => {\n      if (loadingSubmit) {\n        return;\n      }\n\n      setLoadingSubmit(true);\n\n      try {\n        formRef.current?.setErrors({});\n\n        await userSchema.validate(data, {\n          abortEarly: false,\n        });\n\n        const response = await api.post('/users', data);\n\n        setUsers([...users, response.data]);\n\n        reset();\n\n        toast.success('Usuário criado com sucesso!');\n      } catch (err) {\n        if (err instanceof YupValidationError) {\n          const errors = getValidationErrors(err);\n          formRef.current?.setErrors(errors);\n          return;\n        }\n\n        if (err.response) {\n          toast.error(`Erro ao criar usuário: ${err.response.data.message}`);\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n          );\n        }\n      } finally {\n        setLoadingSubmit(false);\n      }\n    },\n    [users, loadingSubmit],\n  );\n\n  const handleUpdateUser = useCallback(\n    async (data: Omit<IUser, 'id' | 'profile'>, { reset }) => {\n      if (loadingSubmit) {\n        return;\n      }\n\n      setLoadingSubmit(true);\n\n      try {\n        formRef.current?.setErrors({});\n\n        await userSchema.validate(data, {\n          abortEarly: false,\n        });\n\n        const response = await api.put(`/users/${userId}`, data);\n\n        const usersWithoutEdited = users.filter(user => user.id !== userId);\n\n        setUsers([...usersWithoutEdited, response.data]);\n\n        setUserId('');\n\n        reset();\n\n        toast.success('Usuário atualizado com sucesso!');\n      } catch (err) {\n        if (err instanceof YupValidationError) {\n          const errors = getValidationErrors(err);\n          formRef.current?.setErrors(errors);\n          return;\n        }\n\n        if (err.response) {\n          toast.error(\n            `Erro ao atualizar usuário: ${err.response.data.message}`,\n          );\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n          );\n        }\n      } finally {\n        setLoadingSubmit(false);\n      }\n    },\n    [users, userId, loadingSubmit],\n  );\n\n  return (\n    <Container>\n      <Loading show={loadingPage} />\n\n      <Header />\n\n      <Aside />\n\n      <Main>\n        <Title title=\"Gerenciar usuários\" />\n\n        <DoubleColumn>\n          <Form\n            ref={formRef}\n            onSubmit={!userId ? handleAddUser : handleUpdateUser}\n          >\n            <Input placeholder=\"Usuário\" name=\"username\" icon={FiUser} />\n\n            <Input\n              placeholder=\"Senha\"\n              name=\"password\"\n              type=\"password\"\n              icon={FiLock}\n            />\n\n            <Select\n              name=\"profile_id\"\n              icon={FiBriefcase}\n              defaultValue=\"null\"\n              optionsArray={profilesOptions}\n            />\n\n            <ButtonGroup>\n              {!userId ? (\n                <Button type=\"submit\" loading={loadingSubmit}>\n                  Adicionar\n                </Button>\n              ) : (\n                <>\n                  <Button type=\"submit\" loading={loadingSubmit}>\n                    Atualizar\n                  </Button>\n\n                  <Button\n                    type=\"submit\"\n                    backgroundColor=\"#f44336\"\n                    onClick={handleUngetUser}\n                  >\n                    Cancelar\n                  </Button>\n                </>\n              )}\n            </ButtonGroup>\n          </Form>\n\n          {users.length > 0 && (\n            <UsersList>\n              {users.map(user => (\n                <li key={user.id}>\n                  <FiEdit2 size={20} onClick={() => handleGetUser(user)} />\n                  {/* <FiTrash\n                    size={20}\n                    onClick={() => handleRemoveUser(user.id)}\n                  /> */}\n                  <span>{user.username}</span>\n                </li>\n              ))}\n            </UsersList>\n          )}\n        </DoubleColumn>\n      </Main>\n    </Container>\n  );\n};\n\nexport default Users;\n"]},"metadata":{},"sourceType":"module"}