{"ast":null,"code":"import _slicedToArray from\"/home/ondaniel/santiago/sisgie/new_frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useCallback}from'react';import{useParams}from'react-router-dom';import{Form}from'@unform/web';import{FiCheck}from'react-icons/fi';import{toast}from'react-toastify';import{Container,Main,InputGroup,WarnMessage,Payment}from'./styles';import Loading from'../../components/Loading';import Table from'../../components/Table';import Header from'../../components/Header';import Aside from'../../components/Aside';import Title from'../../components/Title';import Input from'../../components/Input';import Button from'../../components/Button';import Popup from'../../components/Popup';import Document from'../../components/Document';import api from'../../services/api';import{formatPaymentMethod,formatCoin}from'../../utils/formatFunctions';var Payments=function Payments(){var _useParams=useParams(),contract_id=_useParams.contract_id;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),payments=_useState2[0],setPayments=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),confirmMessage=_useState4[0],setConfirmMessage=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),payment=_useState6[0],setPayment=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),discharge=_useState8[0],setDischarge=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loadingPage=_useState10[0],setLoadingPage=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loadingSubmit=_useState12[0],setLoadingSubmit=_useState12[1];useEffect(function(){setLoadingPage(true);api.get(\"contracts/\".concat(contract_id,\"/payments\")).then(function(response){return setPayments(response.data);}).catch(function(){toast.error('Erro ao carragar pagamentos! Por favor, tente novamente mais tarde.');}).finally(function(){setLoadingPage(false);});},[contract_id]);var handleDischargePayment=useCallback(function(){if(loadingSubmit){return;}setLoadingSubmit(true);api.post('/discharges',{payment_id:payment.id}).then(function(response){var dischargeData=response.data;var paymentsList=payments;paymentsList.forEach(function(p){if(p.id===payment.id){Object.assign(p,{discharged:true,discharge:dischargeData});}});setDischarge(dischargeData);setPayments(paymentsList);toast.success('Pagamento recebido com sucesso!');}).catch(function(err){if(err.response){toast.error(\"Erro ao receber pagamento: \".concat(err.response.data.message));}else{toast.error('Erro interno do servidor! Por favor, tente novamente mais tarde.');}}).finally(function(){setConfirmMessage('');setLoadingSubmit(false);});},[payment,payments,loadingSubmit]);var handleClosePopup=useCallback(function(){setPayment({});setDischarge({});},[]);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Loading,{show:loadingPage}),/*#__PURE__*/React.createElement(Header,null),/*#__PURE__*/React.createElement(Aside,null),/*#__PURE__*/React.createElement(Main,null,/*#__PURE__*/React.createElement(Title,{title:\"Gerenciar pagamentos\"}),/*#__PURE__*/React.createElement(Table,{isVoid:payments.length<=0,voidMessage:\"N\\xE3o h\\xE1 pagamentos para serem recebidos!\"},/*#__PURE__*/React.createElement(\"thead\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,\"Operador\"),/*#__PURE__*/React.createElement(\"td\",null,\"Valor\"),/*#__PURE__*/React.createElement(\"td\",null,\"M\\xE9todo utilizado\"),/*#__PURE__*/React.createElement(\"td\",null,\"Data de recebimento\"))),/*#__PURE__*/React.createElement(\"tbody\",null,payments.map(function(actualPayment){return/*#__PURE__*/React.createElement(Payment,{discharged:actualPayment.discharged,key:actualPayment.id,onClick:function onClick(){return setPayment(actualPayment);}},/*#__PURE__*/React.createElement(\"td\",null,actualPayment.user.username),/*#__PURE__*/React.createElement(\"td\",null,formatCoin(actualPayment.amount)),/*#__PURE__*/React.createElement(\"td\",null,formatPaymentMethod(actualPayment.method)),/*#__PURE__*/React.createElement(\"td\",null,actualPayment.discharged?actualPayment.discharge_day:'-'));})))),!!payment.id&&/*#__PURE__*/React.createElement(Popup,{title:\"Receber\",handleClosePopup:handleClosePopup},!discharge.id&&!payment.discharged&&/*#__PURE__*/React.createElement(Form,{onSubmit:handleDischargePayment},/*#__PURE__*/React.createElement(WarnMessage,null,/*#__PURE__*/React.createElement(\"strong\",null,\" ATEN\\xC7\\xC3O: \"),\"esta a\\xE7\\xE3o n\\xE3o pode ser desfeita! Digite\",/*#__PURE__*/React.createElement(\"b\",null,\" CONFIRMAR \"),\"para receber o pagamento.\"),/*#__PURE__*/React.createElement(InputGroup,null,/*#__PURE__*/React.createElement(Input,{name:\"confirm_message\",icon:FiCheck,value:confirmMessage,onChange:function onChange(e){return setConfirmMessage(e.target.value);}})),/*#__PURE__*/React.createElement(Button,{disabled:confirmMessage!=='CONFIRMAR',type:\"submit\",loading:loadingSubmit},\"Receber\")),(discharge.id||payment.discharge&&payment.discharge.receipt_url)&&/*#__PURE__*/React.createElement(Document,{name:\"Recibo\",link:discharge.receipt_url||payment.discharge.receipt_url||''})));};export default Payments;","map":{"version":3,"sources":["/home/ondaniel/santiago/sisgie/new_frontend/src/pages/ReceivePaymentsByContract/index.tsx"],"names":["React","useEffect","useState","useCallback","useParams","Form","FiCheck","toast","Container","Main","InputGroup","WarnMessage","Payment","Loading","Table","Header","Aside","Title","Input","Button","Popup","Document","api","formatPaymentMethod","formatCoin","Payments","contract_id","payments","setPayments","confirmMessage","setConfirmMessage","payment","setPayment","discharge","setDischarge","loadingPage","setLoadingPage","loadingSubmit","setLoadingSubmit","get","then","response","data","catch","error","finally","handleDischargePayment","post","payment_id","id","dischargeData","paymentsList","forEach","p","Object","assign","discharged","success","err","message","handleClosePopup","length","map","actualPayment","user","username","amount","method","discharge_day","e","target","value","receipt_url"],"mappings":"8HAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,WAArC,KAAwD,OAAxD,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,OAASC,IAAT,KAAqB,aAArB,CACA,OAASC,OAAT,KAAwB,gBAAxB,CACA,OAASC,KAAT,KAAsB,gBAAtB,CAEA,OAASC,SAAT,CAAoBC,IAApB,CAA0BC,UAA1B,CAAsCC,WAAtC,CAAmDC,OAAnD,KAAkE,UAAlE,CACA,MAAOC,CAAAA,OAAP,KAAoB,0BAApB,CACA,MAAOC,CAAAA,KAAP,KAAkB,wBAAlB,CACA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,KAAP,KAAkB,wBAAlB,CACA,MAAOC,CAAAA,KAAP,KAAkB,wBAAlB,CACA,MAAOC,CAAAA,KAAP,KAAkB,wBAAlB,CACA,MAAOC,CAAAA,MAAP,KAAmB,yBAAnB,CACA,MAAOC,CAAAA,KAAP,KAAkB,wBAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,2BAArB,CAGA,MAAOC,CAAAA,GAAP,KAAgB,oBAAhB,CACA,OAASC,mBAAT,CAA8BC,UAA9B,KAAgD,6BAAhD,CAMA,GAAMC,CAAAA,QAAkB,CAAG,QAArBA,CAAAA,QAAqB,EAAM,gBACPrB,SAAS,EADF,CACvBsB,WADuB,YACvBA,WADuB,eAGCxB,QAAQ,CAAC,EAAD,CAHT,wCAGxByB,QAHwB,eAGdC,WAHc,8BAIa1B,QAAQ,CAAC,EAAD,CAJrB,yCAIxB2B,cAJwB,eAIRC,iBAJQ,8BAKD5B,QAAQ,CAAC,EAAD,CALP,yCAKxB6B,OALwB,eAKfC,UALe,8BAMG9B,QAAQ,CAAC,EAAD,CANX,yCAMxB+B,SANwB,eAMbC,YANa,8BAOOhC,QAAQ,CAAC,KAAD,CAPf,0CAOxBiC,WAPwB,gBAOXC,cAPW,gCAQWlC,QAAQ,CAAC,KAAD,CARnB,2CAQxBmC,aARwB,gBAQTC,gBARS,gBAU/BrC,SAAS,CAAC,UAAM,CACdmC,cAAc,CAAC,IAAD,CAAd,CACAd,GAAG,CACAiB,GADH,qBACoBb,WADpB,eAEGc,IAFH,CAEQ,SAAAC,QAAQ,QAAIb,CAAAA,WAAW,CAACa,QAAQ,CAACC,IAAV,CAAf,EAFhB,EAGGC,KAHH,CAGS,UAAM,CACXpC,KAAK,CAACqC,KAAN,CACE,qEADF,EAGD,CAPH,EAQGC,OARH,CAQW,UAAM,CACbT,cAAc,CAAC,KAAD,CAAd,CACD,CAVH,EAWD,CAbQ,CAaN,CAACV,WAAD,CAbM,CAAT,CAeA,GAAMoB,CAAAA,sBAAsB,CAAG3C,WAAW,CAAC,UAAM,CAC/C,GAAIkC,aAAJ,CAAmB,CACjB,OACD,CAEDC,gBAAgB,CAAC,IAAD,CAAhB,CAEAhB,GAAG,CACAyB,IADH,CACQ,aADR,CACuB,CACnBC,UAAU,CAAEjB,OAAO,CAACkB,EADD,CADvB,EAIGT,IAJH,CAIQ,SAAAC,QAAQ,CAAI,CAChB,GAAMS,CAAAA,aAAa,CAAGT,QAAQ,CAACC,IAA/B,CAEA,GAAMS,CAAAA,YAAY,CAAGxB,QAArB,CAEAwB,YAAY,CAACC,OAAb,CAAqB,SAAAC,CAAC,CAAI,CACxB,GAAIA,CAAC,CAACJ,EAAF,GAASlB,OAAO,CAACkB,EAArB,CAAyB,CACvBK,MAAM,CAACC,MAAP,CAAcF,CAAd,CAAiB,CACfG,UAAU,CAAE,IADG,CAEfvB,SAAS,CAAEiB,aAFI,CAAjB,EAID,CACF,CAPD,EASAhB,YAAY,CAACgB,aAAD,CAAZ,CAEAtB,WAAW,CAACuB,YAAD,CAAX,CAEA5C,KAAK,CAACkD,OAAN,CAAc,iCAAd,EACD,CAvBH,EAwBGd,KAxBH,CAwBS,SAAAe,GAAG,CAAI,CACZ,GAAIA,GAAG,CAACjB,QAAR,CAAkB,CAChBlC,KAAK,CAACqC,KAAN,sCACgCc,GAAG,CAACjB,QAAJ,CAAaC,IAAb,CAAkBiB,OADlD,GAGD,CAJD,IAIO,CACLpD,KAAK,CAACqC,KAAN,CACE,kEADF,EAGD,CACF,CAlCH,EAmCGC,OAnCH,CAmCW,UAAM,CACbf,iBAAiB,CAAC,EAAD,CAAjB,CACAQ,gBAAgB,CAAC,KAAD,CAAhB,CACD,CAtCH,EAuCD,CA9CyC,CA8CvC,CAACP,OAAD,CAAUJ,QAAV,CAAoBU,aAApB,CA9CuC,CAA1C,CAgDA,GAAMuB,CAAAA,gBAAgB,CAAGzD,WAAW,CAAC,UAAM,CACzC6B,UAAU,CAAC,EAAD,CAAV,CACAE,YAAY,CAAC,EAAD,CAAZ,CACD,CAHmC,CAGjC,EAHiC,CAApC,CAKA,mBACE,oBAAC,SAAD,mBACE,oBAAC,OAAD,EAAS,IAAI,CAAEC,WAAf,EADF,cAGE,oBAAC,MAAD,MAHF,cAKE,oBAAC,KAAD,MALF,cAOE,oBAAC,IAAD,mBACE,oBAAC,KAAD,EAAO,KAAK,CAAC,sBAAb,EADF,cAGE,oBAAC,KAAD,EACE,MAAM,CAAER,QAAQ,CAACkC,MAAT,EAAmB,CAD7B,CAEE,WAAW,CAAC,+CAFd,eAIE,8CACE,2CACE,yCADF,cAEE,sCAFF,cAGE,oDAHF,cAIE,oDAJF,CADF,CAJF,cAYE,iCACGlC,QAAQ,CAACmC,GAAT,CAAa,SAAAC,aAAa,qBACzB,oBAAC,OAAD,EACE,UAAU,CAAEA,aAAa,CAACP,UAD5B,CAEE,GAAG,CAAEO,aAAa,CAACd,EAFrB,CAGE,OAAO,CAAE,yBAAMjB,CAAAA,UAAU,CAAC+B,aAAD,CAAhB,EAHX,eAKE,8BAAKA,aAAa,CAACC,IAAd,CAAmBC,QAAxB,CALF,cAME,8BAAKzC,UAAU,CAACuC,aAAa,CAACG,MAAf,CAAf,CANF,cAOE,8BAAK3C,mBAAmB,CAACwC,aAAa,CAACI,MAAf,CAAxB,CAPF,cAQE,8BACGJ,aAAa,CAACP,UAAd,CAA2BO,aAAa,CAACK,aAAzC,CAAyD,GAD5D,CARF,CADyB,EAA1B,CADH,CAZF,CAHF,CAPF,CAyCG,CAAC,CAACrC,OAAO,CAACkB,EAAV,eACC,oBAAC,KAAD,EAAO,KAAK,CAAC,SAAb,CAAuB,gBAAgB,CAAEW,gBAAzC,EACG,CAAC3B,SAAS,CAACgB,EAAX,EAAiB,CAAClB,OAAO,CAACyB,UAA1B,eACC,oBAAC,IAAD,EAAM,QAAQ,CAAEV,sBAAhB,eACE,oBAAC,WAAD,mBACE,qDADF,iEAGE,2CAHF,6BADF,cAQE,oBAAC,UAAD,mBACE,oBAAC,KAAD,EACE,IAAI,CAAC,iBADP,CAEE,IAAI,CAAExC,OAFR,CAGE,KAAK,CAAEuB,cAHT,CAIE,QAAQ,CAAE,kBAAAwC,CAAC,QAAIvC,CAAAA,iBAAiB,CAACuC,CAAC,CAACC,MAAF,CAASC,KAAV,CAArB,EAJb,EADF,CARF,cAiBE,oBAAC,MAAD,EACE,QAAQ,CAAE1C,cAAc,GAAK,WAD/B,CAEE,IAAI,CAAC,QAFP,CAGE,OAAO,CAAEQ,aAHX,YAjBF,CAFJ,CA6BG,CAACJ,SAAS,CAACgB,EAAV,EACClB,OAAO,CAACE,SAAR,EAAqBF,OAAO,CAACE,SAAR,CAAkBuC,WADzC,gBAEC,oBAAC,QAAD,EACE,IAAI,CAAC,QADP,CAEE,IAAI,CACFvC,SAAS,CAACuC,WAAV,EAAyBzC,OAAO,CAACE,SAAR,CAAkBuC,WAA3C,EAA0D,EAH9D,EA/BJ,CA1CJ,CADF,CAqFD,CAnKD,CAqKA,cAAe/C,CAAAA,QAAf","sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Form } from '@unform/web';\nimport { FiCheck } from 'react-icons/fi';\nimport { toast } from 'react-toastify';\n\nimport { Container, Main, InputGroup, WarnMessage, Payment } from './styles';\nimport Loading from '../../components/Loading';\nimport Table from '../../components/Table';\nimport Header from '../../components/Header';\nimport Aside from '../../components/Aside';\nimport Title from '../../components/Title';\nimport Input from '../../components/Input';\nimport Button from '../../components/Button';\nimport Popup from '../../components/Popup';\nimport Document from '../../components/Document';\nimport IPayment from '../../entities/IPayment';\nimport IDischarge from '../../entities/IDischarge';\nimport api from '../../services/api';\nimport { formatPaymentMethod, formatCoin } from '../../utils/formatFunctions';\n\ninterface IParams {\n  contract_id: string;\n}\n\nconst Payments: React.FC = () => {\n  const { contract_id } = useParams<IParams>();\n\n  const [payments, setPayments] = useState([] as IPayment[]);\n  const [confirmMessage, setConfirmMessage] = useState('');\n  const [payment, setPayment] = useState({} as IPayment);\n  const [discharge, setDischarge] = useState({} as IDischarge);\n  const [loadingPage, setLoadingPage] = useState(false);\n  const [loadingSubmit, setLoadingSubmit] = useState(false);\n\n  useEffect(() => {\n    setLoadingPage(true);\n    api\n      .get(`contracts/${contract_id}/payments`)\n      .then(response => setPayments(response.data))\n      .catch(() => {\n        toast.error(\n          'Erro ao carragar pagamentos! Por favor, tente novamente mais tarde.',\n        );\n      })\n      .finally(() => {\n        setLoadingPage(false);\n      });\n  }, [contract_id]);\n\n  const handleDischargePayment = useCallback(() => {\n    if (loadingSubmit) {\n      return;\n    }\n\n    setLoadingSubmit(true);\n\n    api\n      .post('/discharges', {\n        payment_id: payment.id,\n      })\n      .then(response => {\n        const dischargeData = response.data as IDischarge;\n\n        const paymentsList = payments;\n\n        paymentsList.forEach(p => {\n          if (p.id === payment.id) {\n            Object.assign(p, {\n              discharged: true,\n              discharge: dischargeData,\n            });\n          }\n        });\n\n        setDischarge(dischargeData);\n\n        setPayments(paymentsList);\n\n        toast.success('Pagamento recebido com sucesso!');\n      })\n      .catch(err => {\n        if (err.response) {\n          toast.error(\n            `Erro ao receber pagamento: ${err.response.data.message}`,\n          );\n        } else {\n          toast.error(\n            'Erro interno do servidor! Por favor, tente novamente mais tarde.',\n          );\n        }\n      })\n      .finally(() => {\n        setConfirmMessage('');\n        setLoadingSubmit(false);\n      });\n  }, [payment, payments, loadingSubmit]);\n\n  const handleClosePopup = useCallback(() => {\n    setPayment({} as IPayment);\n    setDischarge({} as IDischarge);\n  }, []);\n\n  return (\n    <Container>\n      <Loading show={loadingPage} />\n\n      <Header />\n\n      <Aside />\n\n      <Main>\n        <Title title=\"Gerenciar pagamentos\" />\n\n        <Table\n          isVoid={payments.length <= 0}\n          voidMessage=\"Não há pagamentos para serem recebidos!\"\n        >\n          <thead>\n            <tr>\n              <td>Operador</td>\n              <td>Valor</td>\n              <td>Método utilizado</td>\n              <td>Data de recebimento</td>\n            </tr>\n          </thead>\n          <tbody>\n            {payments.map(actualPayment => (\n              <Payment\n                discharged={actualPayment.discharged}\n                key={actualPayment.id}\n                onClick={() => setPayment(actualPayment)}\n              >\n                <td>{actualPayment.user.username}</td>\n                <td>{formatCoin(actualPayment.amount)}</td>\n                <td>{formatPaymentMethod(actualPayment.method)}</td>\n                <td>\n                  {actualPayment.discharged ? actualPayment.discharge_day : '-'}\n                </td>\n              </Payment>\n            ))}\n          </tbody>\n        </Table>\n      </Main>\n\n      {!!payment.id && (\n        <Popup title=\"Receber\" handleClosePopup={handleClosePopup}>\n          {!discharge.id && !payment.discharged && (\n            <Form onSubmit={handleDischargePayment}>\n              <WarnMessage>\n                <strong> ATENÇÃO: </strong>\n                esta ação não pode ser desfeita! Digite\n                <b> CONFIRMAR </b>\n                para receber o pagamento.\n              </WarnMessage>\n\n              <InputGroup>\n                <Input\n                  name=\"confirm_message\"\n                  icon={FiCheck}\n                  value={confirmMessage}\n                  onChange={e => setConfirmMessage(e.target.value)}\n                />\n              </InputGroup>\n\n              <Button\n                disabled={confirmMessage !== 'CONFIRMAR'}\n                type=\"submit\"\n                loading={loadingSubmit}\n              >\n                Receber\n              </Button>\n            </Form>\n          )}\n\n          {(discharge.id ||\n            (payment.discharge && payment.discharge.receipt_url)) && (\n            <Document\n              name=\"Recibo\"\n              link={\n                discharge.receipt_url || payment.discharge.receipt_url || ''\n              }\n            />\n          )}\n        </Popup>\n      )}\n    </Container>\n  );\n};\n\nexport default Payments;\n"]},"metadata":{},"sourceType":"module"}