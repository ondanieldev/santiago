{"ast":null,"code":"import _regeneratorRuntime from\"/home/ondaniel/santiago/sisgie/new_frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ondaniel/santiago/sisgie/new_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/ondaniel/santiago/sisgie/new_frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext,useCallback,useState,useContext}from'react';import api from'../services/api';var AuthContext=createContext({});export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){var token=localStorage.getItem('@Santiago:token');var user=localStorage.getItem('@Santiago:user');if(token&&user){api.defaults.headers.authorization=\"bearer \".concat(token);return{token:token,user:JSON.parse(user)};}return{};}),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var signIn=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2){var username,password,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:username=_ref2.username,password=_ref2.password;_context.next=3;return api.post('/sessions',{username:username,password:password});case 3:response=_context.sent;localStorage.setItem('@Santiago:token',response.data.token);localStorage.setItem('@Santiago:user',JSON.stringify(response.data.user));api.defaults.headers.authorization=\"bearer \".concat(response.data.token);setData(response.data);case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref3.apply(this,arguments);};}(),[]);var signOut=useCallback(function(){localStorage.removeItem('@Santiago:token');localStorage.removeItem('@Santiago:user');delete api.defaults.headers.authorization;setData({});},[]);return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{user:data.user,signIn:signIn,signOut:signOut}},children);};export var useAuth=function useAuth(){var context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthContext Provider');}return context;};","map":{"version":3,"sources":["/home/ondaniel/santiago/sisgie/new_frontend/src/hooks/auth.tsx"],"names":["React","createContext","useCallback","useState","useContext","api","AuthContext","AuthProvider","children","token","localStorage","getItem","user","defaults","headers","authorization","JSON","parse","data","setData","signIn","username","password","post","response","setItem","stringify","signOut","removeItem","useAuth","context","Error"],"mappings":"uXAAA,MAAOA,CAAAA,KAAP,EAAgBC,aAAhB,CAA+BC,WAA/B,CAA4CC,QAA5C,CAAsDC,UAAtD,KAAwE,OAAxE,CAGA,MAAOC,CAAAA,GAAP,KAAgB,iBAAhB,CAkBA,GAAMC,CAAAA,WAAW,CAAGL,aAAa,CAAkB,EAAlB,CAAjC,CAEA,MAAO,IAAMM,CAAAA,YAAsB,CAAG,QAAzBA,CAAAA,YAAyB,MAAkB,IAAfC,CAAAA,QAAe,MAAfA,QAAe,eAC9BL,QAAQ,CAAY,UAAM,CAChD,GAAMM,CAAAA,KAAK,CAAGC,YAAY,CAACC,OAAb,CAAqB,iBAArB,CAAd,CACA,GAAMC,CAAAA,IAAI,CAAGF,YAAY,CAACC,OAAb,CAAqB,gBAArB,CAAb,CAEA,GAAIF,KAAK,EAAIG,IAAb,CAAmB,CACjBP,GAAG,CAACQ,QAAJ,CAAaC,OAAb,CAAqBC,aAArB,kBAA+CN,KAA/C,EAEA,MAAO,CAAEA,KAAK,CAALA,KAAF,CAASG,IAAI,CAAEI,IAAI,CAACC,KAAL,CAAWL,IAAX,CAAf,CAAP,CACD,CAED,MAAO,EAAP,CACD,CAX+B,CADsB,wCAC/CM,IAD+C,eACzCC,OADyC,eActD,GAAMC,CAAAA,MAAM,CAAGlB,WAAW,2FACxB,uKAASmB,QAAT,OAASA,QAAT,CAAmBC,QAAnB,OAAmBA,QAAnB,uBACyBjB,CAAAA,GAAG,CAACkB,IAAJ,CAAS,WAAT,CAAsB,CAC3CF,QAAQ,CAARA,QAD2C,CAE3CC,QAAQ,CAARA,QAF2C,CAAtB,CADzB,QACQE,QADR,eAMEd,YAAY,CAACe,OAAb,CAAqB,iBAArB,CAAwCD,QAAQ,CAACN,IAAT,CAAcT,KAAtD,EACAC,YAAY,CAACe,OAAb,CACE,gBADF,CAEET,IAAI,CAACU,SAAL,CAAeF,QAAQ,CAACN,IAAT,CAAcN,IAA7B,CAFF,EAKAP,GAAG,CAACQ,QAAJ,CAAaC,OAAb,CAAqBC,aAArB,kBAA+CS,QAAQ,CAACN,IAAT,CAAcT,KAA7D,EAEAU,OAAO,CAACK,QAAQ,CAACN,IAAV,CAAP,CAdF,sDADwB,gEAiBxB,EAjBwB,CAA1B,CAoBA,GAAMS,CAAAA,OAAO,CAAGzB,WAAW,CAAC,UAAM,CAChCQ,YAAY,CAACkB,UAAb,CAAwB,iBAAxB,EACAlB,YAAY,CAACkB,UAAb,CAAwB,gBAAxB,EAEA,MAAOvB,CAAAA,GAAG,CAACQ,QAAJ,CAAaC,OAAb,CAAqBC,aAA5B,CAEAI,OAAO,CAAC,EAAD,CAAP,CACD,CAP0B,CAOxB,EAPwB,CAA3B,CASA,mBACE,oBAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAEP,IAAI,CAAEM,IAAI,CAACN,IAAb,CAAmBQ,MAAM,CAANA,MAAnB,CAA2BO,OAAO,CAAPA,OAA3B,CAA7B,EACGnB,QADH,CADF,CAKD,CAhDM,CAkDP,MAAO,IAAMqB,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAuB,CAC5C,GAAMC,CAAAA,OAAO,CAAG1B,UAAU,CAACE,WAAD,CAA1B,CAEA,GAAI,CAACwB,OAAL,CAAc,CACZ,KAAM,IAAIC,CAAAA,KAAJ,CAAU,qDAAV,CAAN,CACD,CAED,MAAOD,CAAAA,OAAP,CACD,CARM","sourcesContent":["import React, { createContext, useCallback, useState, useContext } from 'react';\n\nimport IUser from '../entities/IUser';\nimport api from '../services/api';\n\ninterface AuthState {\n  token: string;\n  user: IUser;\n}\n\ninterface SignInCredentials {\n  username: string;\n  password: string;\n}\n\ninterface AuthContextData {\n  user: IUser;\n  signIn(credentials: SignInCredentials): Promise<void>;\n  signOut(): void;\n}\n\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData);\n\nexport const AuthProvider: React.FC = ({ children }) => {\n  const [data, setData] = useState<AuthState>(() => {\n    const token = localStorage.getItem('@Santiago:token');\n    const user = localStorage.getItem('@Santiago:user');\n\n    if (token && user) {\n      api.defaults.headers.authorization = `bearer ${token}`;\n\n      return { token, user: JSON.parse(user) };\n    }\n\n    return {} as AuthState;\n  });\n\n  const signIn = useCallback(\n    async ({ username, password }: SignInCredentials) => {\n      const response = await api.post('/sessions', {\n        username,\n        password,\n      });\n\n      localStorage.setItem('@Santiago:token', response.data.token);\n      localStorage.setItem(\n        '@Santiago:user',\n        JSON.stringify(response.data.user),\n      );\n\n      api.defaults.headers.authorization = `bearer ${response.data.token}`;\n\n      setData(response.data);\n    },\n    [],\n  );\n\n  const signOut = useCallback(() => {\n    localStorage.removeItem('@Santiago:token');\n    localStorage.removeItem('@Santiago:user');\n\n    delete api.defaults.headers.authorization;\n\n    setData({} as AuthState);\n  }, []);\n\n  return (\n    <AuthContext.Provider value={{ user: data.user, signIn, signOut }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = (): AuthContextData => {\n  const context = useContext(AuthContext);\n\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthContext Provider');\n  }\n\n  return context;\n};\n"]},"metadata":{},"sourceType":"module"}